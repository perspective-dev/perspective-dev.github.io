(globalThis.webpackChunk_perspective_dev_docs=globalThis.webpackChunk_perspective_dev_docs||[]).push([[912],{5912:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.r(t);var l=a(4832),r=a(797),i=a(9662),o=a(7680),s=a(2554),c=a(8863),h=a(913),u=a(3223),d=Object.defineProperty,g=(e,t)=>{for(var a in t)d(e,a,{get:t[a],enumerable:!0})};Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var p={none:"none",ordinal:"ordinal",time:"time",linear:"linear"},m=e=>{let t="crossValues",a=null,n=null,l=()=>{let l=n=>{let l=a?e[t].filter(e=>a==e.name):e[t];return!("crossValues"==t&&l.length>1)&&l.some(e=>n.includes(e.type))};return 0===e[t].length?p.none:n!=p.time&&l(["datetime","date"])?p.time:n!=p.linear&&l(["integer","float"])||n==p.ordinal?p.linear:p.ordinal};return l.settingName=(...e)=>e.length?(t=e[0],l):t,l.settingValue=(...e)=>e.length?(a=e[0],l):a,l.excludeType=(...e)=>e.length?(n=e[0],l):n,l},y={};g(y,{domain:()=>b,labelFunction:()=>w,scale:()=>v});var f=e=>Array.isArray(e)?e.flat(1/0):[e],x=e=>{let t=t=>e(t);return(0,l.qz)(t,e),t.bandwidth=(...a)=>a.length?(e.bandwidth(...a),t):Math.max(e.bandwidth(),1),t},v=()=>(e=>{let t=t=>e(t);return(0,l.qz)(t,e),t.ticks=function(){return[]},t})(x(r.WH())),b=()=>{let e=["crossValue"],t="horizontal",a=t=>{let a=f(t);return n([...new Set(a.map(t=>t[e[0]]))])},n=e=>"vertical"==t?e.reverse():e;return a.valueName=(...t)=>t.length?(e=[t[0]],a):e[0],a.valueNames=(...t)=>t.length?(e=t[0],a):e,a.orient=(...e)=>e.length?(t=e[0],a):t,a},w=e=>t=>t[e].join("|"),V={};g(V,{component:()=>N,domain:()=>A,labelFunction:()=>M,scale:()=>z,tickFormatFunction:()=>L});var _=()=>{let e=[0,0],t="percent",a=a=>{switch(t){case"domain":a[0]-=e[0],a[1]+=e[1];break;case"percent":{let t=a[1]-a[0];a[0]-=e[0]*t,a[1]+=e[1]*t;break}default:throw new Error("Unknown padUnit: "+t)}return a};return a.pad=function(...t){return t.length?(e=t[0],a):e},a.padUnit=function(...e){return e.length?(t=e[0],a):t},a},k=function(e){if(Array.isArray(e)){let t=Array(e.length);for(let a=0;a<e.length;a++)t[a]=e[a];return t}return Array.from(e)},S=(e,t)=>{let a=Math.ceil(Math.abs(Math.log10(t-e)))+1;return e=>Math.abs(e)>=1e7?r.GPZ(".3s")(e):Number.isInteger(e)?r.GPZ(",.0f")(e):r.GPZ(`,.${a}f`)(e)};function Rt(e){return e.getRootNode().host}function Ot(e){return e.closest("#container.chart")}var z=()=>r.m4Y(),A=()=>{let e=function(){let e=[function(e){return e}],t=null,a=[],n=_(),l=function(l){let r,s=new Array(l.length),c=!0,h=!1,u=e[Symbol.iterator]();try{for(let e;!(c=(e=u.next()).done);c=!0){let t=e.value;for(let e=0;e<l.length;e++){let a=t(l[e],e);Array.isArray(a)?s.push.apply(s,k(a)):s.push(a)}}}catch(g){h=!0,r=g}finally{try{!c&&u.return&&u.return()}finally{if(h)throw r}}let d=[o.A(s),i.A(s)];if(d[0]=null==d[0]?o.A(a):o.A([d[0]].concat(k(a))),d[1]=null==d[1]?i.A(a):i.A([d[1]].concat(k(a))),null!=t){let e=Math.max(Math.abs(d[1]-t),Math.abs(d[0]-t));d[0]=t-e,d[1]=t+e}return n(d)};return l.accessors=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],l):e},l.pad=function(...e){return e.length?(n.pad(e[0]),l):n.pad},l.padUnit=function(...e){return e.length?(n.padUnit(e[0]),l):n.padUnit},l.include=function(...e){return e.length?(a=e[0],l):a},l.symmetricalAbout=function(...e){return e.length?(t=e[0],l):t},l.paddingStrategy=function(...e){return e.length?(n=e[0],l):n},l}().pad([0,.1]).padUnit("percent"),t=["crossValue"],a=a=>(e.accessors(t.map(e=>t=>parseFloat(t[e]))),n(f(a)));l.qz(a,e);let n=a=>{if("domain"==e.padUnit()){let n=(e=>{let a=t.map(t=>e.map(e=>e[t]).sort((e,t)=>e-t).filter((e,t,a)=>0===t||e!==a[t-1]).reduce((e,t,a,n)=>0===a||e<=t-n[a-1]?e:Math.abs(t-n[a-1])));return Math.min(...a)})(a);return e.pad([n/2,n/2])(a)}return e(a)};return a.valueName=(...e)=>e.length?(t=[e[0]],a):t[0],a.valueNames=(...e)=>e.length?(t=e[0],a):t,a},M=e=>t=>t[e][0],L=S,N=e=>{let t=null,a="horizontal",n=null,i=(e,t)=>{let n=e.getBoundingClientRect();t.each((e,t,l)=>{let i=r.Ltv(l[t]).node().getBoundingClientRect();("vertical"==a&&n.width<i.width||"horizontal"==a&&n.height<i.height)&&(e=>{r.Ltv(e).select("text").node().style.fontSize="80%"})(l[t])})},o=(e,t,a)=>{let n=((e,t)=>{try{return Ot(e.node()).querySelector(".cartesian-chart").querySelector(`.${t}-axis`)}catch{return null}})(e,t);n&&i(n,e)},s=()=>({bottom:l.l7,left:l.V4,top:l.tl,right:l.eH,decorate:o});return s.domain=(...e)=>e.length?(t=e[0],s):t,s.orient=(...e)=>e.length?(a=e[0],s):a,s.settingName=(...e)=>e.length?(n=e[0],s):n,s},$={};g($,{domain:()=>P,labelFunction:()=>C,scale:()=>T});var T=()=>r.w7C(),P=()=>{let e=l.M3(),t=["crossValue"],a=a=>(e.accessors(t.map(e=>t=>new Date(t[e]))),n(f(a)));l.qz(a,e,l.HN("include","paddingStrategy"));let n=a=>{let n=Math.abs((e=>{let a=t.map(t=>e.map(e=>new Date(e[t]).getTime()).sort((e,t)=>e-t).filter((e,t,a)=>0===t||e!==a[t-1]).reduce((e,t,a,n)=>0===a||Math.abs(e)<=Math.abs(t-n[a-1])?Math.abs(e):Math.abs(t-n[a-1])));return Math.min(...a)})(a));return e.padUnit("domain").pad([n/2,n/2])(a)};return a.valueName=(...e)=>e.length?(t=[e[0]],a):t[0],a.valueNames=(...e)=>e.length?(t=e[0],a):t,a},C=e=>t=>new Date(t[e][0]),E={};g(E,{component:()=>F,domain:()=>j,labelFunction:()=>I,scale:()=>W});var R=(e,t,a)=>{let n=6,i=6,o=((...e)=>{let t={},a=e=>{for(let a of Object.keys(t))e[a](t[a]);return e};for(let n of e)a[n]=(...e)=>e.length?(t[n]=e[0],a):t[n];return a})("tickFormat","ticks","tickArguments","tickValues","tickPadding"),s=(...e)=>{},c=null,h=(0,l.d8)("g","group"),u=(0,l.d8)("path","domain"),d=(e,t)=>g()?`translate(${t}, ${e})`:`translate(${e}, ${t})`,g=()=>"left"===e||"right"===e,p=l=>{c?l.each((l,p,y)=>{let f=y[p],x=(0,r.Ltv)(f),v="bottom"===e||"right"===e?1:-1,b=a.range(),w=(e=>g()?e.map(e=>[e[1],e[0]]):e)([[b[0],v*n],[b[0],0],[b[1],0],[b[1],v*n]]);u(x,[l]).attr("d",(0,r.n8j)()(w)).attr("stroke","#000").attr("fill","none");let V=h(x,c),_=e=>Array.isArray(i)?i[e]:i,k=e=>{let t=0;for(let a=0;a<e;a++)t+=_(a);return t};V.attr("transform",(e,t)=>d(0,v*k(t))).each((e,n,l)=>{let i=(0,r.Ltv)(l[n]),c=m(a,e);o(t(c)).decorate((e,t)=>s(e,t,n)).tickSizeInner(_(n)).tickOffset(e=>c.step(e)/2)(i),i.select("path.domain").attr("visibility","hidden")}),V.exit().attr("transform",(e,t)=>d(0,v*k(t)))}):o(t(a).decorate(s))(l)},m=(e,t)=>{function a(t){let a=t.domain;return a.reduce((t,a)=>t+e(a),0)/a.length}return a.ticks=()=>t,a.tickFormat=()=>e=>e.text,a.copy=()=>m(e,t),a.step=t=>t.domain.length*e.step(),(0,l.qz)(a,e,(0,l.HN)("ticks","step","copy")),a};return p.tickSize=(...e)=>e.length?(i=n=Number(e[0]),p):i,p.tickSizeInner=(...e)=>e.length?(i=Array.isArray(e[0])?e[0]:Number(e[0]),p):i,p.tickSizeOuter=(...e)=>e.length?(n=Number(e[0]),p):n,p.decorate=(...e)=>e.length?(s=e[0],p):s,p.groups=(...e)=>e.length?(c=e[0],p):c,(0,l.qz)(p,o),p},O=e=>R("top",l.c1,e),H=e=>R("bottom",l.C1,e),B=e=>R("left",l.qU,e),D=e=>R("right",l.ly,e),W=()=>x(r.WH()).padding(.5),j=()=>{let e=["crossValue"],t="horizontal",a=t=>{let a=f(t);return n([...Array.from(new Set(a.map(t=>t[e[0]])))])},n=e=>"vertical"==t?e.reverse():e;return a.valueName=(...t)=>t.length?(e=[t[0]],a):e[0],a.valueNames=(...t)=>t.length?(e=t[0],a):e,a.orient=(...e)=>e.length?(t=e[0],a):t,a},I=(e,t)=>a=>a[e].map((e,a)=>{let n=t.crossValues[a].type;return"datetime"===n?new Date(e).toLocaleString(void 0,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3}):"date"===n?new Date(e).toLocaleDateString():e}).join("|"),F=e=>{let t="horizontal",a="crossValues",n=null,i=()=>{let l=e[a].length>1,r=s(n),i=r.map(c),u=l?i.map(e=>e.size):i[0].size,g=i.reduce((e,t)=>e+t.size,0),p=e=>a=>{let n=e(a);return l&&n.groups(r).tickSizeInner(u).tickSizeOuter(g),"horizontal"!==t&&n.tickPadding(10),n},m=o(l);return{bottom:p(m.bottom),left:p(m.left),right:p(m.right),top:p(m.top),size:`${g+10}px`,decorate:(e,a,n)=>{let l=i[n].rotation;"horizontal"===t&&d(e,l),h(e,l)}}},o=e=>e?{bottom:H,left:B,top:O,right:D}:{bottom:l.C1,left:l.qU,top:l.c1,right:l.ly},s=e=>{let t=[];return e.forEach(e=>{(e&&e.split?e.split("|"):[e]).forEach((a,n)=>{for(;t.length<=n;)t.push([]);let l=t[n];l.length>0&&l[l.length-1].text===a?l[l.length-1].domain.push(e):l.push({text:a,domain:[e]})})}),t.reverse()},c=a=>{let n=e.size.width,l=Math.max(...a.map(e=>e.text?e.text.length:0));return"horizontal"===t?a&&16*a.length>n-100?{size:6.62*l+10,rotation:90}:a&&a.length*(6*l+10)>n-100?{size:4*l+20,rotation:45}:{size:25,rotation:0}:{size:6.62*l+10,rotation:0}},h=(e,a)=>{let n=a?(e,t)=>e.x+e.width+14>t.x+t.width:(e,t)=>e.x<=t.x+t.width&&t.x<=e.x+e.width&&e.y<=t.y+t.height&&t.y<=e.y+e.height,l="horizontal"==t?u(e):null,i=[];e.each((e,t,a)=>{let o=r.Ltv(a[t]),s=(e=>{let t=-1!==e.indexOf(",")?",":" ",a=e.substring(e.indexOf("(")+1,e.indexOf(")")).split(t).map(e=>parseInt(e));for(;a.length<2;)a.push(0);return a})(o.attr("transform")),c=o.node().getBBox(),h={x:c.x+s[0],y:c.y+s[1],width:c.width,height:c.height},u=i.some(e=>n(e,h))||l&&!((e,t)=>e.x>=t.x&&e.x+e.width<=t.x+t.width&&e.y>=t.y&&e.y+e.height<=t.y+t.height)(h,l);o.attr("visibility",u?"hidden":""),u||i.push(h)})},u=e=>{let t=Ot(e.node());if(null===t)return;let a=t.querySelector(".cartesian-chart"),n=a.querySelector(".x-axis"),l=a.getBoundingClientRect(),r=n.getBoundingClientRect();return{x:l.left-r.left,width:l.width,y:l.top-r.top,height:l.height}},d=(e,t)=>{let a=(e=>e?e<60?`rotate(-${e} 5 5)`:`rotate(-${e} 3 7)`:"translate(0, 8)")(t),n=t?"end":"";e.each((e,t,l)=>{r.Ltv(l[t]).select("text").attr("transform",a).style("text-anchor",n)})};return i.orient=(...e)=>e.length?(t=e[0],i):t,i.settingName=(...e)=>e.length?(a=e[0],i):a,i.domain=(...e)=>e.length?(n=e[0],i):n,i},Y={none:y,ordinal:E,time:$,linear:V},q=e=>{let t,a=null,n="horizontal",r="crossValues",i=["crossValue"],o=null,s=null,c=["include","paddingStrategy","pad"],h={},u=l=>{let u=m(e).excludeType(a).settingName(r).settingValue(t)(),p=Y[u],y=p.domain().valueNames(i);c.forEach(e=>{h[e]&&y[e]&&y[e](h[e])}),y.orient&&y.orient(n);let f=y(l);null!==o&&(f=o(f)),s&&"number"==typeof f[0]&&(s[0]=f[0]=Math.min(f[0],s[0]),s[1]=f[1]=Math.max(f[1],s[1]));let x=p.hasOwnProperty("component")?d(p,f,l):g(),v=p==V?L(f[0],f[1]):void 0;return{scale:p.scale(),domain:f,domainFunction:y,labelFunction:p.labelFunction,component:{bottom:x.bottom,left:x.left,top:x.top,right:x.right},size:x.size,decorate:x.decorate,label:e[r].map(e=>e.name).join(", "),tickFormatFunction:v}},d=(t,a,l)=>t.component(e).orient(n).settingName(r).domain(a)(l),g=()=>({bottom:l.l7,left:l.V4,top:l.tl,right:l.eH,decorate:()=>{}});return u.memoValue=(...e)=>e.length?(s=e[0],u):s,u.excludeType=(...e)=>e.length?(a=e[0],u):a,u.orient=(...e)=>e.length?(n=e[0],u):n,u.settingName=(...e)=>e.length?(r=e[0],u):r,u.settingValue=(...e)=>e.length?(t=e[0],u):t,u.valueName=(...e)=>e.length?(i=[e[0]],u):i[0],u.valueNames=(...e)=>e.length?(i=e[0],u):i,u.modifyDomain=e=>e?(o=e,u):o,c.forEach(e=>{u[e]=(...t)=>t.length?(h[e]=t[0],u):h[e]}),u},U=(e,t)=>X(e,t,(e,t)=>e.svgPlotArea(t),!1),K=(e,t)=>X(e,t,(e,t)=>e.canvasPlotArea(t).svgPlotArea(l.s9()),!0),X=(e,t,a,n)=>{let i=null,o=null,s=l.jo({xScale:e.scale,yScale:t.scale,xAxis:e.component,yAxis:t.component}).xDomain(e.domain).xLabel(e.label).xAxisHeight(e.size).xDecorate(e.decorate).xTickFormat(e.tickFormatFunction).yDomain(t.domain).yLabel(t.label).yAxisWidth(t.size).yDecorate(t.decorate).yOrient("left").yTickFormat(t.tickFormatFunction);e.decorate&&s.xDecorate(e.decorate),t.decorate&&s.yDecorate(t.decorate),s.xPaddingInner&&s.xPaddingInner(1),s.xPaddingOuter&&s.xPaddingOuter(.5),s.yPaddingInner&&s.yPaddingInner(1),s.yPaddingOuter&&s.yPaddingOuter(.5),s.axisSplitter=(...e)=>e.length?(i=e[0],s):i,s.altAxis=(...e)=>e.length?(o=e[0],s):o,s.plotArea=function(...e){return 0==e.length?n?this.canvasPlotArea():this.svgPlotArea():a(this,...e)};let c=s.decorate();return s.decorate((a,h)=>{let u=a.select("d3fc-svg.plot-area"),d=u.select("svg").node();d.setAttribute("viewBox",`0 0 ${u.node().clientWidth} ${u.node().clientHeight}`),d.setAttribute("preserveAspectRatio","none");for(let e of["x-axis","y-axis"])a.select(`d3fc-svg.${e} svg`).node().setAttribute("preserveAspectRatio","none");if(c(a,h),n){let e=a.select(".svg-plot-area").node(),t=a.select(".canvas-plot-area").node();r.Ubm([e,t]).order()}if(i){if(i.haveSplit()){let c=i.altData(),u=l.d8("d3fc-svg","y2-axis").key(e=>e),d=l.d8("g","y-series").key(e=>e);a.append("div").attr("class","y-label right-label").style("grid-column",5).style("-ms-grid-column",5).style("grid-row",3).style("-ms-grid-row",3).style("width",o.size||"1em").style("display","flex").style("align-items","center").style("justify-content","center").append("span").attr("class","y-label splitter-label").style("transform","rotate(-90deg)");let g=o.scale.domain(o.domain),p=o.component.right(g);if(p.tickFormat(o.tickFormatFunction),o.decorate&&p.decorate(o.decorate),u(a,["right"]).attr("class",e=>`y2-axis ${e}-axis`).on("measure",function(e,t){let{width:a,height:n}=e.detail;"left"===t&&r.Ltv(e.currentTarget).select("svg").attr("viewBox",`${-a} 0 ${a} ${n}`).attr("preserveAspectRatio","none"),g.range([n,0])}).on("draw",function(e,t){r.Ltv(e.currentTarget).select("svg").call(p)}),n){let n=a=>{let n=s.plotArea();n.context(a.node().getContext("2d")).xScale(e.scale);let l=[t.scale,g];[h,c].forEach((e,t)=>{n.yScale(l[t]),n(e)})};a.select("d3fc-canvas.plot-area").on("draw",function(e,t){n(r.Ltv(e.currentTarget).select("canvas"))})}else{let n=function(a){let n=s.plotArea();n.xScale(e.scale);let l=[t.scale,g];d(a,[h,c]).each((e,t,a)=>{n.yScale(l[t]),r.Ltv(a[t]).datum(e).call(n)})};a.select("d3fc-svg.plot-area").on("draw",function(e,t){n(r.Ltv(e.currentTarget).select("svg"))})}}i(a)}}),s};function Ht(e,t,a){let n=e.select(t);return n.size()>0?n:a()}function Bt(e,t,a="right"){if("right"===a||"bottom"===a)return e[a]<t[a];if("left"===a||"top"===a)return e[a]>t[a];throw`Direction being checked for overflow is invalid: ${a}`}function Dt(e,t,a,n=0){let l="x"===e?"width":"height",r=t[e],i=t[e]+t[l],o=a[e],s=a[e]+a[l];return o+n>r&&o-n<i||s+n>r&&s-n<i||o+n<r&&s-n>i}function Wt(e,t){switch(e){case"date":case"datetime":return t instanceof Date?t:new Date(parseInt(t)).toLocaleString([],{dateStyle:"short",timeStyle:"medium"});case"integer":return parseInt(t,10);case"float":return parseFloat(t)}return t}function jt(e,t){return 0===t.crossValues.length||0===e.crossValue.length?[]:((e.crossValue.split?e.crossValue.split("|"):Array.isArray(e.crossValue)?e.crossValue:[e.crossValue])||[e.key]).map((e,a)=>({name:t.crossValues[a].name,value:Wt(t.crossValues[a].type,e)}))}function It(e,t){if(0===t.splitValues.length)return[];let a=[e.mainValue];return e.key?a=e.key.split("|"):e.mainValue?.split&&(a=e.mainValue.split("|")),t.splitValues.map((e,t)=>({name:e.name,value:Wt(e.type,a[t])}))}function Ft(e,t){return t.mainValues.length>1?e.mainValues?t.mainValues.map((t,a)=>({name:t.name,value:Wt(t.type,e.mainValues[a])})):t.mainValues.map(a=>({name:a.name,value:Wt(a.type,e.row[Yt(e.key,a,t.realValues)])})):[{name:t.mainValues[0].name,value:Wt(t.mainValues[0].type,e.colorValue||e.mainValue-e.baseValue||e.mainValue||e.mainValues)}]}function Yt(e,t,a){if(!e)return t.name;if(e.includes("|")){let n=e.split("|");return n[n.length-1]===t.name?e:`${a.includes(n[n.length-1])?n.slice(0,n.length-1).join("|"):e}|${t.name}`}return a.includes(e)?t.name:`${e}|${t.name}`}function qt(e,t,a){Ut(e,jt(t,a).concat(It(t,a)).concat(Ft(t,a)))}function Ut(e,t){e.select("#tooltip-values").selectAll("li").data(t).join("li").each(function(e){(0,r.Ltv)(this).text(`${e.name}: `).append("b").text(G(e.value))})}var G=e=>null==e?"-":e.toLocaleString(void 0,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),Z=e=>[e.name,"==",e.value],J=(e,t,a)=>{let n=Ft(t,a).map(e=>e.name),l=jt(t,a).map(Z),r=It(t,a).map(Z),i=a.filter.concat(l).concat(r);e.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{column_names:n,config:{filter:i},row:t.row}}))},Q=()=>{let e=!1,t=null,a=null,n=!1,l=l=>{let i=l.node();if(!i||!i.isConnected)return void Jt(t);let o=(0,r.Ltv)(Ot(i));t=Kt(o);let s=function(e,i){qt(t,i,a);let s=l.nodes(),c=s.indexOf(this);Xt(o.node(),s[c],t,n),(0,r.Ltv)(s[c]).style("opacity","0.7")};e?l.each(function(e){return s.call(this,void 0,e)}):(l.on("mouseover",s).on("mouseout",function(e,a){Jt(t);let n=l.nodes(),i=n.indexOf(this);n&&(0,r.Ltv)(n[i]).style("opacity","1")}),(()=>{let e=null,t=t=>{let a=t.node();t.on("click",(t,n)=>J(a,n,e))};return t.settings=(...a)=>a.length?(e=a[0],t):e,t})().settings(a)(l))};return l.alwaysShow=(...t)=>t.length?(e=t[0],l):e,l.centered=(...e)=>e.length?(n=e[0],l):n,l.settings=(...e)=>e.length?(a=e[0],l):a,l};function Kt(e){return Ht(e,"div.tooltip",()=>e.append("div").attr("class","tooltip").style("z-index",3).style("opacity",0).html('<ul id="tooltip-values"></ul>\n'))}function Xt(e,t,a,n){let l=e.getBoundingClientRect(),r=t.getBoundingClientRect(),i=r.left+r.width/2-l.left,o=r.top-l.top+e.scrollTop;n&&(o=r.top+r.height/2-l.top+e.scrollTop),a.style("left",`${i}px`).style("top",`${o}px`).style("opacity",.9),n&&([i,o]=Gt(a,l)),Zt(a,l,i,o,n)}function Gt(e,t){let a=e.node().getBoundingClientRect(),n=a.width/2,l=a.left-n-t.left;e.style("left",`${l}px`);let r=a.height/2,i=a.top-r-t.top;return e.style("top",`${i}px`),[l,i]}function Zt(e,t,a,n,l=!1){let r=e.node().getBoundingClientRect();if(Bt(t,r)){let n=r.right-t.right;e.style("left",a-n+"px")}if(Bt(t,r,"bottom")){let a=r.bottom-t.bottom;e.style("top",n-a+"px")}if(l){if(Bt(t,r,"left")){let n=r.left-t.left;e.style("left",a-n+"px")}if(Bt(t,r,"top")){let a=r.top-t.top;e.style("top",n-a+"px")}}}function Jt(e){e&&e.style("opacity",0)}function Qt(e,t){let a=e.mainValues.length>1?l.SY(l.WZ()):l.WZ();return a=a.decorate(a=>{Q().settings(e)(a),a.style("fill",e=>t(e.key))}),l.XM(ee(a)).crossValue(e=>e.crossValue).mainValue(e=>e.mainValue?e.mainValue:0).baseValue(e=>e.baseValue)}var ee=e=>{let t=t=>e(t);return l.qz(t,e),t.bandwidth=(...a)=>a.length?(e.bandwidth(Math.max(a[0],1)),t):e.bandwidth(),t};function ea(e){return e.split("|").slice(0,-1).join("|")}function ta(e,t){return e.data.map(e=>Object.entries(e).filter(([e,a])=>e.split("|").at(-1)===t&&!!a).map(([e,t])=>t)).flat()}function aa(e){let t=e.data&&e.data.length>0?e.data[0]:{},a=Object.keys(t).filter(e=>"__ROW_PATH__"!==e);return ia().settings(e).domain(a)()}function na(e,t){let a=ta(e,t),n=[...new Set(a)].sort();return ia().settings(e).domain(n)()}function la(e,t){let a=[...new Set(t)];return ia().settings(e).domain(a)()}function ra(e){let t=e.data[0]??{},a=Object.keys(t).filter(e=>"__ROW_PATH__"!==e).map(e=>ea(e)),n=[...new Set(a)];return ia().settings(e).domain(n)()}function ia(){let e=null,t=null,a={},n=e=>sa(e,a.colorStyles&&a.colorStyles.opacity),l=()=>{let l=a.colorStyles,i=t||[l.series];if(i||e.length>1){let t=e.length>1?l.scheme:i;return r.UMr(t.map(n)).domain(e)}return null};return l.domain=(...t)=>0===t.length?e:(e=t[0],l),l.defaultColors=(...e)=>e.length?(t=e[0],l):t,l.mapFunction=(...e)=>e.length?(n=e[0],l):n,l.settings=(...e)=>e.length?(a=e[0],l):a,l}function oa(e){return ca(1)(e)}function sa(e,t=.5){return ca(t)(e)}function ca(e){return t=>{let a=r.yWT(t);return null!=a&&(a.opacity=e),a+""}}var te={none:w,ordinal:I,time:C,linear:M},ae=e=>{let t=m(e),a="__ROW_PATH__",n=te[t()],r=(t,l)=>n(a,e)(t);return(0,l.qz)(r,t),r.valueName=(...e)=>e.length?(a=e[0],r):a,r};function ha(e,t,{stack:a=!1,excludeEmpty:n=!1}={}){let l=t||e.data;return e.splitValues.length>0?ua(e,l,{stack:a,excludeEmpty:n}):[l]}function ua(e,t,{stack:a=!1,excludeEmpty:n=!1}){let l={};return t.forEach(e=>{let t={},r={};Object.keys(e).filter(e=>"__ROW_PATH__"!==e).filter(t=>!n||null!=e[t]&&null!=e[t]).forEach(n=>{let l=n.split("|"),i=l[l.length-1],o=e[n]||0,s=`${i}${o>=0?"+ve":"-ve"}`,c=l.slice(0,l.length-1).join("|"),h=r[c]=r[c]||{__ROW_PATH__:e.__ROW_PATH__},u=t[s]||0;h.__KEY__=c,a?(h[i]=u+o,h[`__BASE_VALUE__${i}`]=u,t[s]=h[i]):h[i]=o,h.row=e}),Object.keys(r).forEach(e=>{(l[e]=l[e]||[]).push(r[e])})}),Object.keys(l).map(e=>{let t=l[e];return t.key=e,t})}function da(e,t){let a={stack:!1},n=ha(e,t,a).map(t=>ma(e,t,a));return e.mainValues.length>1?n.reduce((e,t)=>e.concat(t)):n}function ga(e,t){let a={stack:!0};return ha(e,t,a).map(t=>ma(e,t,a))}function pa(e,t,{stack:a=!1}){let n=ae(e);return e=>{let l=t=>a&&t[`__BASE_VALUE__${e.name}`]||0,r=t.map((t,a)=>({crossValue:n(t,a),mainValue:t[e.name]?t[e.name]:null,baseValue:l(t),key:t.__KEY__?`${t.__KEY__}|${e.name}`:e.name,row:t.row||t}));return r.key=r[0].key,r}}function ma(e,t,{stack:a=!1}){let n=pa(e,t,{stack:a});return e.mainValues.length>1?e.mainValues.map(n):n(e.mainValues[0])}function ya(e){let t=e.select("g.legendCells"),a=e.node().getBoundingClientRect();if(!Bt(a,t.node().getBoundingClientRect()))return;let n=e.select(".legend");t.selectAll(".label").text((e,t,l)=>{let r=l[t];if(Bt(a,r.getBoundingClientRect())){let t=fa(r,n,a);return`${e.substring(0,t-3)}...`}return e})}function fa(e,t,a){let n=e.getBoundingClientRect(),l=t.node().createSVGPoint();return l.x=a.right-n.left-3,l.y=0,e.getCharNumAtPosition(l)}var ne=10;function xa(e,t,a){let n=r.Ltv(Rt(e).getContainer()).node().getBoundingClientRect(),l=e.getBoundingClientRect(),i={top:l.top+a-ne,right:l.right+t+ne,bottom:l.bottom+a+ne,left:l.left+t-ne},o={x:t,y:a};return[{edge:"right",dimension:"x"},{edge:"left",dimension:"x"},{edge:"top",dimension:"y"},{edge:"bottom",dimension:"y"}].forEach(e=>{if(Bt(n,i,e.edge)){let t=i[e.edge]-n[e.edge];o[e.dimension]=o[e.dimension]-t}}),o}var le="resize.for-dragging";function va(){let e=!0,t=null,a=a=>{let n=a.node(),l=n.getRootNode().host.closest("perspective-viewer");n.style.cursor="move",t.legend&&(n.style.left=t.legend.left,n.style.top=t.legend.top);let i=r.$Er().on("drag",function(a){let l=xa(this,a.dx,a.dy);this.style.left=`${this.offsetLeft+l.x}px`,this.style.top=`${this.offsetTop+l.y}px`;let r={left:this.style.left,top:this.style.top};t.legend={...t.legend,...r},e=Va(n)?wa(n):ba(n,e)});i.on("end",function(e){r.Ltv(window).on(le,null),l?.dispatchEvent(new Event("perspective-config-update"))}),a.call(i)};return a.settings=(...e)=>e.length?(t=e[0],a):t,a}function ba(e,t){return!1!==t&&r.Ltv(window).on(le,function(){let t=xa(e,0,0);e.style.left=`${e.offsetLeft+t.x}px`,e.style.top=`${e.offsetTop+t.y}px`}),!1}function wa(e){return r.Ltv(window).on(le,null),e.style.left="auto",!0}function Va(e){let t=e.getBoundingClientRect(),a=r.Ltv(Ot(e)).node().getBoundingClientRect();return t.right+ne+5>=a.right&&t.top-ne-5<=a.top}var re="horizontal-drag-handle",ie="vertical-drag-handle",oe="dragHandles",se="resize";function _a(){let e=9,t=3,a=null,n={height:100,width:100},l={height:null,width:null},i=[],o=(e,t)=>i.filter(t=>t.event===e).forEach(e=>e.execute(t)),s=n=>{if(he(n))return;let i={left:e=>o(se,{horizontal:A(e),vertical:!1}),top:e=>o(se,{horizontal:!1,vertical:L(e)}),right:e=>o(se,{horizontal:M(e),vertical:!1}),bottom:e=>o(se,{horizontal:!1,vertical:N(e)}),topleft:e=>o(se,{horizontal:A(e),vertical:L(e)}),topright:e=>o(se,{horizontal:M(e),vertical:L(e)}),bottomright:e=>o(se,{horizontal:M(e),vertical:N(e)}),bottomleft:e=>o(se,{horizontal:A(e),vertical:N(e)})},s=n.node();a.legend&&(s.style.height=a.legend.height,s.style.width=a.legend.width);let u=s.getBoundingClientRect(),d=n.append("svg").attr("id",oe).attr("width",u.width).attr("height",u.height),g=d.append("g"),p=e=>"left"===e||"right"===e,m={left:0,top:e,right:u.width-e,bottom:e},y={left:e,top:0,right:e,bottom:u.height-e},[f,x,v,b]=["left","top","right","bottom"].map(a=>g.append("rect").attr("id",`drag${a}`).attr("class",p(a)?ie:re).attr("y",y[a]).attr("x",m[a]).attr("height",p(a)?u.height-2*e:e).attr("width",p(a)?e:u.width-2*e).attr("fill",p(a)?"lightgreen":"lightblue").attr("fill-opacity",0).style("z-index",t).attr("cursor",p(a)?"ew-resize":"ns-resize").call(r.$Er().on("drag",i[a]))),w=e=>`${e[0]}${e[1]}`,V={topleft:"nwse",topright:"nesw",bottomright:"nwse",bottomleft:"nesw"},[_,k,S,z]=[["top","left"],["top","right"],["bottom","right"],["bottom","left"]].map(a=>g.append("rect").attr("id",`drag${w(a)}`).attr("class",`corner-drag-handle ${a[0]} ${a[1]}`).attr("height",e).attr("width",e).attr("fill","red").attr("fill-opacity",0).style("z-index",t).attr("cursor",`${V[w(a)]}-resize`).call(r.$Er().on("drag",i[w(a)])));function A(e){let t=h(xa(f.node(),e.x,0).x,d,"width",(e,t)=>e-t);return s.style.left=`${s.offsetLeft+t}px`,s.style.width=s.offsetWidth-t+"px",$(),T(v,t,"width","x")}function M(e){let t=-h(xa(v.node(),e.dx,0).x,d,"width",(e,t)=>e+t);return!c(t,"x",v,e)&&(s.style.width=s.offsetWidth-t+"px",$(),T(v,t,"width","x"))}function L(e){let t=h(xa(x.node(),0,e.y).y,d,"height",(e,t)=>e-t);return s.style.top=`${s.offsetTop+t}px`,s.style.height=s.offsetHeight-t+"px",$(),T(b,t,"height","y")}function N(e){let t=-h(xa(b.node(),0,e.dy).y,d,"height",(e,t)=>e+t);return!c(t,"y",b,e)&&(s.style.height=s.offsetHeight-t+"px",$(),T(b,t,"height","y"))}function $(){let e={top:s.style.top,left:s.style.left,height:s.style.height,width:s.style.width};a.legend={...a.legend,...e}}function T(e,t,a,n){return de(d,a,t),ue(e,n,t),ce(d,t,a,"height"===a?ie:re),P(d),0!=t}function P(t){_.attr("y",0),k.attr("y",0).attr("x",t.attr("width")-e),S.attr("y",t.attr("height")-e).attr("x",t.attr("width")-e),z.attr("y",t.attr("height")-e).attr("x",0)}function C(e,t,a){l[e]&&l[e]<u[e]&&(s.style[e]=`${l[e]}px`,T(a,u[e]-l[e],e,t))}C("height","y",b),C("width","x",v),P(d)};function c(e,t,a,n){return l=t,r=a,i=n,e<0&&i[l]<Number(r.attr(l))||((e,t,a,n)=>e>0&&n[t]>Number(a.attr(t)))(e,t,a,n);var l,r,i}function h(e,t,a,r){let i=r(Number(t.attr(a)),e);if(i<n[a]){return r(e,n[a]-i)}if(l[a]&&i>l[a]){return r(e,l[a]-i)}return e}return s.on=(e,t)=>(i.push({event:e,execute:t}),s),s.zIndex=e=>(t=e,s),s.settings=(...e)=>e.length?(a=e[0],s):a,s.minWidth=e=>(n.width=e,l.width&&(l.width=Math.max(n.width,l.width)),s),s.minHeight=e=>(n.height=e,l.height&&(l.height=Math.max(n.height,l.height)),s),s.handleWidth=t=>(e=t,s),s.maxWidth=e=>(l.width=e,n.width=Math.min(n.width,l.width),s),s.maxHeight=e=>(l.height=e,n.height=Math.min(n.height,l.height),s),s}var ce=(e,t,a,n)=>{e.selectAll(`.${n}`).each((e,n,l)=>{let i=l[n];r.Ltv(i).attr(a,i.getBoundingClientRect()[a]-t)})},he=e=>e.select(`#${oe}`).size()>0,ue=(e,t,a)=>e.attr(t,Number(e.attr(t))-a),de=(e,t,a)=>e.attr(t,e.node().getBoundingClientRect()[t]-a),ge=(e,t)=>{let a,n,r=e||s.Vl(),i=[],o=1,c=t.legend&&t.legend.pageIndex?t.legend.pageIndex:0,h=()=>{},u=va().settings(t),d=e=>{i=r.scale().domain(),n=_a().settings(t).maxHeight(16*i.length+20).on("resize",()=>g(e)),n(e),u(e),g(e)},g=e=>{x(e),p(e),m(e),ya(e)},p=e=>{let t=b(e);t.style("display",o<=1?"none":"block"),t.select("#page-text").text(`${c+1}/${o}`),t.select("#up-arrow").attr("class",0===c?"disabled":"").on("click",()=>{c>0&&(y(c-1),g(e))}),t.select("#down-arrow").attr("class",c>=o-1?"disabled":"").on("click",()=>{c<o-1&&(y(c+1),g(e))})},m=e=>{o>1&&r.cellFilter(f()),e.select("g.legendCells").remove();let t=w(e);t.call(r);let a=e.select("g.legendCells").node().getBBox();t.attr("height",a.height+20),h(e)},y=e=>{c=e,t.legend={...t.legend,pageIndex:c}},f=()=>(e,t)=>t>=a*c&&t<a*c+a,x=e=>{let t=e.node().getBoundingClientRect(),n=Math.floor(t.height/16)-1;a=n<i.length?n-1:n,o=v(n),c=Math.min(c,o-1)},v=e=>Math.ceil(i.length/e),b=e=>Ht(e,".legend-controls",()=>e.append("g").attr("class","legend-controls").html('<span id="up-arrow">&#9650;</span>\n<span id="page-text"></span>\n<span id="down-arrow">&#9660;</span>\n')),w=e=>Ht(e,".legend",()=>e.append("svg").attr("class","legend"));return d.decorate=(...e)=>e.length?(h=e[0],d):h,(0,l.qz)(d,r),d},pe=e=>ge(s.Vl().shape("circle").shapeRadius(6),e),me=e=>ge(s.Iv().shapePadding(1).labelOffset(3),e),ye=()=>Sa(pe),fe=()=>Sa(me,ka);function ka(e){if(!e)return null;let t=e.domain(),a=e.range().map(e=>r.HRO().type(e)());return r.UMr().domain(t).range(a)}function Sa(e,t=void 0){let a={},n=null,l=null,r=t=>{if(n&&n.range().length>1){let r=e(a);r.scale(n).orient("vertical").on("cellclick",function(e){let t=this.__data__;a.hideKeys=a.hideKeys||[],a.hideKeys.includes(t)?a.hideKeys=a.hideKeys.filter(e=>e!==t):a.hideKeys.push(t),Rt(this)._draw()}),r.labels(e=>{let t=String(e.domain[e.i]).split("|");return a.mainValues.length<=1&&t.length>1?t.slice(0,t.length-1).join("|"):e.domain[e.i]});let i=Ht(t,"div.legend-container",()=>t.append("div"));r.decorate(e=>{let t=e=>a.hideKeys&&a.hideKeys.includes(e),n=e.select("g.legendCells").attr("transform","translate(20,20)").selectAll("g.cell");n.classed("hidden",t),n.append("title").html(e=>e),l&&n.select("circle, path").style("fill",e=>t(e)?null:l(e)).style("stroke",e=>t(e)?null:oa(l(e)))}),i.attr("class","legend-container").attr("borderbox-on-hover",!0).style("z-index","2").call(r)}};return r.settings=(...e)=>0===e.length?a:(a=e[0],r),r.scale=(...e)=>e.length?(n=t?t(e[0]):e[0],r):n,r.color=(...e)=>e.length?(l=e[0],r):l,r}function za(e,t=void 0){let a=t||e.data;return(e.hideKeys?.length??0)>0?a.map(t=>{let a={...t};return e.hideKeys.forEach(e=>{delete a[e]}),a}):a}function Aa(e){let t=e.data,a=e.hideKeys?.length??0,n=e.splitValues.length;return a>0?0===n?t.filter(t=>Object.values(t).reduce((t,a)=>t&&!e.hideKeys.includes(a),!0)):t.map(t=>{let a=Object.entries(t).filter(([t,a])=>!e.hideKeys.includes(ea(t)));return Object.fromEntries(a)}):t}function Ma(e,t){return 0===e?t?t.textStyles.color:"#666":t?t.colorStyles.grid.gridLineColor:"#bbb"}var xe=(e,t)=>e.style("display","none"),ve=(e,t)=>{let a="both",n=!1,r=null,i=null,o=null,s=l.VX(),c=l._8(),h=(e=>(t,a)=>t.style("stroke-width",e=>"1.0").style("stroke",t=>Ma(t,e)))(t),u=xe,d=function(...d){n&&(s=l.Zm().context(o),c=l.YW(),h=(e=>(t,a)=>{t.strokeStyle=Ma(a,e),t.lineWidth=1})(t),u=(e=>(t,a)=>{t.lineWidth=1,t.strokeStyle=Ma(a,e)})(t));let g=s.xScale(r).yScale(i),p="vertical"===a?u:h,m="horizontal"===a?u:h,y=c.xDecorate(p).yDecorate(m);return g.series([y,e])(...d)};return d.orient=(...e)=>e.length?(a=e[0],d):a,d.canvas=(...e)=>e.length?(n=e[0],d):n,d.xScale=(...e)=>e.length?(r=e[0],d):r,d.yScale=(...e)=>e.length?(i=e[0],d):i,d.context=(...e)=>e.length?(o=e[0],d):o,d},be=()=>{let e=_(),t=t=>{let a=e.pad(),n=e.padUnit(),l=1;switch(n){case"domain":break;case"percent":l=t[1]-t[0];break;default:throw new Error("Unknown padUnit: "+n)}let r=t[0]-a[0]*l,i=t[1]+a[1]*l;return t[0]=t[0]>=0&&r<0?0:r,t[1]=t[1]<=0&&i>0?0:i,t};return t.pad=function(...t){return e.pad()},t.padUnit=function(...t){return e.padUnit()},l.qz(t,e),t},we=()=>{let e=null,t=null,a=null,n=null,l=null,i=null,o=!1,s=!1,c=()=>{};function h(c){let h=`d3fc-${s?"canvas":"svg"}.plot-area`;if(a||l){let g=n&&n.domain()[0]instanceof Date,p=r.s_O().on("zoom",o=>{let{transform:s}=o;t.zoom={k:s.k,x:s.x,y:s.y},u(s),c.call(e);let m=1===s.k&&0===s.x&&0===s.y,y=d(c).style("display",m?"none":"");y.select("#zoom-reset").on("click",()=>c.select(h).call(p.transform,r.GSI));let f=y.select("#one-year").style("display",g?"":"none"),x=y.select("#six-months").style("display",g?"":"none"),v=y.select("#one-month").style("display",g?"":"none");if(g){let e=e=>()=>{let t=new Date(a.domain()[0]),o=new Date(t);e(t,o);let s=n.range(),u=(s[1]-s[0])/(n(o)-n(t)),d=-n(t)*u,g=0;if(l){let e=l.domain().reduce((e,t)=>e+t)/2;g=-i(e)*u+l(e)}c.select(h).call(p.transform,r.GSI.translate(d,g).scale(u))};f.on("click",e((e,t)=>t.setYear(e.getFullYear()+1))),x.on("click",e((e,t)=>t.setMonth(e.getMonth()+6))),v.on("click",e((e,t)=>t.setMonth(e.getMonth()+1)))}}),m=e.decorate();e.decorate((e,a)=>{if(m(e,a),!o){o=!0;let a=e.select(h),l=s?window.devicePixelRatio:1;a.on("measure.zoom-range",e=>{if(n&&n.range([0,e.detail.width/l]),i&&i.range([0,e.detail.height/l]),t.zoom){let e=r.GSI.translate(t.zoom.x,t.zoom.y).scale(t.zoom.k);a.call(p.transform,e)}}).call(p)}})}c.call(e)}h.chart=(...t)=>t.length?(e=t[0],h):e,h.settings=(...e)=>e.length?(t=e[0],h):t,h.xScale=(...e)=>e.length?(a=g(e[0]),n=a?a.copy():null,h):a,h.yScale=(...e)=>{if(!e.length)return l;if(l=g(e[0]),i=l?l.copy():null,i){let e=i.domain();i.domain([e[1],e[0]])}return h},h.canvas=(...e)=>e.length?(s=e[0],h):s,h.onChange=(...e)=>e.length?(c=e[0],h):c;let u=e=>{let t={...e};if(a&&(a.domain(e.rescaleX(n).domain()),t.xDomain=a.domain()),l){let a=e.rescaleY(i).domain();l.domain([a[1],a[0]]),t.yDomain=l.domain()}c(t)},d=e=>Ht(e,".zoom-controls",()=>e.append("div").attr("class","zoom-controls").style("display","none").html('<button id="zoom-reset">Reset zoom</button>\n<button id="one-year">1 Year</button>\n<button id="six-months">6 Months</button>\n<button id="one-month">1 Month</button>\n')),g=e=>e&&e.nice?e:null;return h};function La(e,t){let a=ga(t,za(t)),n=aa(t),r=ye().settings(t).scale(n),i=Qt(t,n).orient("horizontal"),o=l.VX().mapping((e,t)=>e[t]).series(a.map(()=>i)),s=q(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[0]).excludeType(p.ordinal).include([0]).paddingStrategy(be())(a),c=q(t).excludeType(p.linear).settingName("crossValues").valueName("crossValue").orient("vertical")(a),h=U(s,c).plotArea(ve(o,t).orient("horizontal"));h.yPaddingInner&&(h.yPaddingInner(.5),h.yPaddingOuter(.25),i.align("left")),h.xNice&&h.xNice();let u=we().chart(h).settings(t).yScale(c.scale);e.datum(a).call(u),e.call(r)}La.plugin={name:"X Bar",category:"X Chart",max_cells:1e3,max_columns:50,render_warning:!0,initial:{names:["X Axis"]}};var Ve=La,_e=e=>2===e.length&&!isNaN(e[0])&&!isNaN(e[1])&&e[0]!==e[1],ke=e=>(0-e[0])/(e[1]-e[0]),Se=(e,t)=>t*e[1]/(t-1),ze=(e,t,a=Ae)=>{let n,r,i,o=e.splitMainValues||[],s=e=>{let t=e.split("|");return o.includes(t[t.length-1])},c=e.mainValues.some(e=>s(e.name));r=c?a(t,e=>!s(e)):t,i=c?a(t,s):null;let h=t=>{if(1===e.mainValues.length)return;let a=e.mainValues.map((e,t)=>({index:t,name:e.name})),r=a.filter(e=>!s(e.name)),i=a.filter(e=>s(e.name)),o=()=>(e=>{let t,a=[],n=!1,r=r=>{r.text("");let o=l.d8("span","splitter-label").key(e=>e),s=!n&&1===a.length,c=t&&0===e.splitValues.length;o(r,a).classed("disabled",s).text(e=>e.name).style("color",e=>c?oa(t(e.name)):void 0).on("click",(t,a)=>{s||(e.splitMainValues=n?e.splitMainValues.filter(e=>e!=a.name):[a.name].concat(e.splitMainValues||[]),t.target.getRootNode().host.closest("perspective-viewer")?.dispatchEvent(new Event("perspective-config-update")),i(r))})},i=e=>{let t=Rt(e.node());t._container.innerHTML="",t._draw()};return r.labels=(...e)=>e.length?(a=e[0],r):a,r.alt=(...e)=>e.length?(n=e[0],r):n,r.color=(...e)=>e.length?(t=e[0],r):t,r})(e).color(n);t.select(".y-label.left-label").call(o().labels(r)),t.select(".y-label.right-label").call(o().labels(i).alt(!0))};return h.color=(...e)=>e.length?(n=e[0],h):n,h.haveSplit=()=>c,h.data=(...e)=>e.length?(r=e[0],h):r,h.altData=(...e)=>e.length?(i=e[0],h):i,h},Ae=(e,t)=>e.map(e=>e.filter(e=>t(e.key))),Me=(e,t)=>e.map(e=>t(e.key)?e:e.map(e=>Object.assign({},e,{mainValue:null}))),Le=(e,t)=>e.map(e=>Me(e,t));function Na(e,t){let a=ga(t,za(t)),n=aa(t),r=ye().settings(t).scale(n),i=Qt(t,n).orient("vertical"),o=l.VX().mapping((e,t)=>e[t]).series(a.map(()=>i)),s=q(t).excludeType(p.linear).settingName("crossValues").valueName("crossValue")(a),c=q(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).excludeType(p.ordinal).orient("vertical").include([0]).paddingStrategy(be()),h=t.mainValues.length>1?Le:Me,u=ze(t,a,h).color(n),d=c(u.data()),g=u.haveSplit()?o:ve(o,t).orient("vertical"),m=U(s,d).axisSplitter(u).plotArea(g);m.xPaddingInner&&(m.xPaddingInner(.5),m.xPaddingOuter(.25),i.align("left")),m.yNice&&m.yNice();let y=we().chart(m).settings(t).xScale(s.scale);if(u.haveSplit()){let e=c(u.altData());((e,t)=>{if(!_e(e)||!_e(t))return;let a=ke(e),n=ke(t);a>n?t[0]=Se(t,a):e[0]=Se(e,n)})(d.domain,e.domain),m.yDomain(d.domain).altAxis(e)}e.datum(u.data()).call(y),e.call(r)}Na.plugin={name:"Y Bar",category:"Y Chart",max_cells:1e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var Ne=Na;function $a(e,t){let a=l.S4(),n=e.data.length*(e.data?.length>0?Object.keys(e.data[0]).length-(e.crossValues?.length>0?1:0):0),r=Math.max(1,Math.min(3,Math.floor(e.size.width/n/2)));return a=a.decorate(e=>{e.style("stroke",e=>oa(t(e[0]&&e[0].key))).style("stroke-width",r)}),a.crossValue(e=>e.crossValue).mainValue(e=>e.mainValue)}function Ta(e,t){let a=ae(e);return t.map((e,t)=>Object.keys(e).filter(e=>"__ROW_PATH__"!==e).map(n=>({key:n,crossValue:a(e,t),mainValue:e[n],row:e})))}var $e=function(e){let t=[];for(let a of e)for(let e=0;e<a.length;e++)null!==a[e].mainValue&&(t[e]=t[e]||[],t[e].push(a[e]));return t},Te=(e,t,a=Math.min)=>{let n=e=>e.reduce((e,t)=>{let n=l(t);return!n||e&&a(e.value,n.value)!==n.value?e:n},null),l=e=>{if(Array.isArray(e))return n(e);let a=t(e);return null!==a?{item:e,value:a}:null},r=n(e);return r?r.item:null},Pe=()=>{let e=Q().alwaysShow(!0),t=null,a=null,n=null,r=null,i=!1,o=null,s="crossValue",c="mainValue",h=null,u=1,d=n=>{let r=`d3fc-${i?"canvas":"svg"}.plot-area`;if(t||a){let t=null,i=l.Wn().on("point",e=>{let l=e.length?p(e[0]):null;t=l?[l.data]:[];let r=l?l.scale:a;g(n,t,r)});n.select(r).on("measure.nearbyTip",()=>g(n,[])).on("click",()=>{t.length&&J(n.node(),t[0],e.settings())}).call(i)}},g=(l,i,o=a)=>{let h=l.select("d3fc-svg.plot-area svg").selectAll("circle.nearbyTip").data(i);h.exit().remove(),h.enter().append("circle").attr("class","nearbyTip").merge(h).attr("r",e=>r?u*Math.sqrt(r(e.size)):10).attr("transform",e=>`translate(${t(e[s])},${o(e[c])})`).style("stroke","none").style("fill",e=>n&&e.key&&sa(n(e.key))),e(h)},p=e=>{let n=a=>n=>void 0===n[c]||null===n[c]||void 0===n[s]||null===n[s]?null:Math.sqrt(Math.pow(t(n[s])-e.x,2)+Math.pow(a(n[c])-e.y,2)),l=n(a),r=Te(o,l,Math.min);if(h){let e=n(h.yScale),t=Te(h.data,e,Math.min);return l(r)<=e(t)?{data:r,scale:a}:{data:t,scale:h.yScale}}return{data:r,scale:a}};return d.scaleFactor=(...e)=>e.length?(u=e[0],d):u,d.xScale=(...e)=>e.length?(t=e[0],d):t,d.yScale=(...e)=>e.length?(a=e[0],d):a,d.color=(...e)=>e.length?(n=e[0],d):n,d.size=(...e)=>e.length?(r=e[0]?e[0].copy().range([40,4e3]):null,d):r,d.canvas=(...e)=>e.length?(i=e[0],d):i,d.data=(...e)=>e.length?(o=e[0],d):o,d.xValueName=(...e)=>e.length?(s=e[0],d):s,d.yValueName=(...e)=>e.length?(c=e[0],d):c,d.altDataWithScale=(...e)=>e.length?(h=e[0],d):h,d.settings=(...t)=>t.length?(e.settings(t[0]),d):e.settings(),l.qz(d,e),d};function Pa(e,t){let a=Ta(t,za(t)),n=aa(t),r=ye().settings(t).scale(n),i=l.b7().series($a(t,n)).orient("horizontal"),o=be().pad([.1,.1]).padUnit("percent"),s=ze(t,$e(a)).color(n),c=q(t).excludeType(p.linear).settingName("crossValues").valueName("crossValue")(a),h=q(t).settingName("mainValues").valueName("mainValue").memoValue(s.haveSplit()?null:t.axisMemo[0]).orient("vertical").paddingStrategy(o),u=h(s.data()),d=ve(i,t).orient("vertical"),g=U(c,u).axisSplitter(s).plotArea(d);g.yNice&&g.yNice();let m=we().chart(g).settings(t).xScale(c.scale),y=Pe().settings(t).xScale(c.scale).yScale(u.scale).color(n).data(a);if(s.haveSplit()){let e=h(s.altData());g.altAxis(e),y.data(s.data()).altDataWithScale({yScale:e.scale,data:s.altData()})}let f=s.data();e.datum(f).call(m),e.call(y),e.call(r)}Pa.plugin={name:"Y Line",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var Ce=Pa,Ee=Math.sqrt(3),Re={draw:function(e,t){let a=Math.sqrt(t/(3*Ee));e.moveTo(0,2*a),e.lineTo(-Ee*a,-a),e.lineTo(Ee*a,-a),e.closePath()}},Oe=[r.hKN,r.BVl,r.jaT,r.yDW,r.N8r,r.ZKi,r.IJl],He={circle:r.hKN,square:r.yDW,cross:r.BVl,diamond:r.jaT,star:r.N8r,triangle:r.ZKi,wye:r.IJl,nabla:Re};function Ca(e){return e.length>1?r.UMr().domain(e).range(Oe):null}function Ea(e,t,a,n,r,i,o=1){let s=(0,l.UK)().crossValue(e=>e.x).mainValue(e=>e.y);return i&&s.type(e=>i(e.row[t])),a&&s.size(e=>Math.round(o*a(e.size))),s.decorate((t,l)=>{let i=n(l.colorValue),s=e.colorStyles?.opacity;if(r){let{type:n}=e.mainValues.find(e=>e.name===r),i=Wt(n,l.row[r]);if(null!==i){t.fillStyle=e.textStyles.color,t.font=e.textStyles.font;let n=0;a&&(n=1*Math.sqrt(o*a(l.size)/Math.PI));let r=n+8;t.fillText(i,r,4)}}t.strokeStyle=oa(i),t.fillStyle=sa(i,s)}),s}function Ra(e,t){return Ca([...new Set(ta(e,t))])}function Oa(e){let t=e.data&&e.data.length>0?e.data[0]:{},a=[];return Object.keys(t).forEach(e=>{if("__ROW_PATH__"!==e){let t=ea(e);a.includes(t)||a.push(t)}}),Ca(a)}function Ha(e,t){let a=e.mainValues.length;return t.map(e=>{let t=Object.keys(e).filter(e=>"__ROW_PATH__"!==e),n=new Array(t.length/a);for(let l=0;l<t.length/a;l++)n[l]={key:ea(t[l*a]),crossValue:e[t[l*a]],mainValue:e[t[l*a+1]],row:e};return n})}function Ba(e,t){let a=$e(Ha(t,Aa(t))),n=ra(t),r=Oa(t),i=null;n.domain().length>=2&&(i=Sa(pe,ka).settings(t).scale(r).color(n));let o=l.b7().series($a(t,n)).orient("horizontal"),s=be().pad([.1,.1]).padUnit("percent"),c=q(t).settingName("mainValues").settingValue(t.mainValues[0].name).valueName("crossValue").memoValue(t.axisMemo[0]).paddingStrategy(s),h=q(t).settingName("mainValues").settingValue(t.mainValues[1].name).valueName("mainValue").memoValue(t.axisMemo[1]).orient("vertical").paddingStrategy(s)(a),u=c(a),d=ve(o,t).orient("vertical"),g=U(u,h).xLabel(t.mainValues[0].name).yLabel(t.mainValues[1].name).plotArea(d);g.xNice&&g.xNice(),g.yNice&&g.yNice();let p=we().chart(g).settings(t).xScale(u.scale).yScale(h.scale),m=Pe().settings(t).xScale(u.scale).yScale(h.scale).color(n).data(a);e.datum(a).call(p),e.call(m),i&&e.call(i)}Ba.plugin={name:"X/Y Line",category:"X/Y Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Tooltip"]},selectMode:"toggle"};var Be=Ba;function Da(e,t){let a=l.b();return a=a.decorate(e=>{e.style("fill",e=>t(e[0].key)).style("opacity",.5)}),a.crossValue(e=>e.crossValue).mainValue(e=>e.mainValue).baseValue(e=>e.baseValue)}function Wa(e,t){let a=ae(e);return t.map((e,t)=>{let n={};return Object.keys(e).filter(e=>"__ROW_PATH__"!==e).map(l=>{let r=l.split("|"),i=r[r.length-1],o=n[i]||0,s=o+e[l];return n[i]=s,{key:l,crossValue:a(e,t),mainValue:s,baseValue:o,row:e}})})}function ja(e,t){let a=Wa(t,za(t)),n=aa(t),r=ye().settings(t).scale(n),i=l.b7().series(Da(0,n).orient("vertical")),o=l.b7().series($a(t,n)).orient("vertical"),s=l.VX().series([i,o]),c=q(t).excludeType(p.linear).settingName("crossValues").valueName("crossValue")(a),h=q(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).excludeType(p.ordinal).orient("vertical").include([0]).paddingStrategy(be()),u=ze(t,a).color(n),d=h(u.data()),g=u.haveSplit()?s:ve(s,t).orient("vertical"),m=U(c,d).axisSplitter(u).plotArea(g);m.yNice&&m.yNice();let y=we().chart(m).settings(t).xScale(c.scale),f=Pe().settings(t).xScale(c.scale).yScale(d.scale).color(n).data(a);if(u.haveSplit()){let e=h(u.altData());m.altAxis(e),f.data(u.data()).altDataWithScale({yScale:e.scale,data:u.altData()})}e.datum(u.data()).call(y),e.call(f),e.call(r)}ja.plugin={name:"Y Area",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var De=ja;function Ia(e,t,a,n){let r=l.s9().size(100),i=e.colorStyles&&e.colorStyles.opacity;return n&&r.type(n(t)),r.decorate(e=>{e.style("stroke",e=>oa(a(e.colorValue||t))).style("fill",e=>sa(a(e.colorValue||t),i))}),r.crossValue(e=>e.crossValue).mainValue(e=>e.mainValue)}function Fa(e){let t=e.data&&e.data.length>0?e.data[0]:{};return Ca(Object.keys(t).filter(e=>"__ROW_PATH__"!==e))}function Ya(e,t){let a=da(t,za(t)),n=Fa(t),r=aa(t),i=fe().settings(t).scale(n).color(r),o=l.VX().mapping((e,t)=>e[t]).series(a.map(e=>Ia(t,e.key,r,n))),s=be().pad([.05,.05]).padUnit("percent"),c=q(t).excludeType(p.linear).settingName("crossValues").valueName("crossValue")(a),h=q(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).orient("vertical").paddingStrategy(s),u=ze(t,a).color(r),d=h(u.data()),g=u.haveSplit()?o:ve(o,t).orient("vertical"),m=U(c,d).axisSplitter(u).plotArea(g);m.yNice&&m.yNice();let y=we().chart(m).settings(t).xScale(c.scale),f=Pe().settings(t).xScale(c.scale).yScale(d.scale).color(r).data(a);if(u.haveSplit()){let e=h(u.altData());m.altAxis(e),f.data(u.data()).altDataWithScale({yScale:e.scale,data:u.altData()})}e.datum(u.data()).call(y),e.call(f),i&&e.call(i)}Ya.plugin={name:"Y Scatter",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var We=Ya;function qa(e,t){return ha(e,t,{excludeEmpty:!0}).map(t=>Ua(e,t))}function Ua(e,t){let a=ae(e),n=t.map((n,l)=>({crossValue:a(n,l),mainValues:e.mainValues.map(e=>n[e.name]),x:n[e.mainValues[0].name],y:n[e.mainValues[1].name],colorValue:e.realValues[2]?n[e.realValues[2]]:void 0,size:e.realValues[3]?n[e.realValues[3]]:void 0,key:t.key,row:n}));return n.key=t.key,n}function Ka(e,t,a,n){return r.m4Y().domain(je(t,a,n))}function Xa(e,t,a,n=null){let l=je(t,a,n),i=e.colorStyles.gradient.full;if(l[0]>=0)i=e.colorStyles.gradient.positive;else if(l[1]<=0)i=e.colorStyles.gradient.negative;else{let e=Math.max(-l[0],l[1]);l=[-e,e]}let o=Ie(i);return r.exT(o).domain(l)}var je=(e,t,a)=>a||A().valueName(t).pad([0,0])(e),Ie=e=>{let t=e.slice(1).map((t,a)=>r.GWP(e[a][1],t[1]));return a=>{let n=e.findIndex((t,n)=>n<e.length-1&&a<=e[n+1][0]&&a>t[0]);if(-1===n)return a<=e[0][0]?e[0][1]:e[e.length-1][1];let l=t[n],[r]=e[n],[i]=e[n+1];return l((a-r)/(i-r))}};function Ga(){let e=null;function t(t){let a=Ht(t,"div.legend-container",()=>t.append("div").attr("class","legend-container legend-color").style("z-index","2")),{width:n,height:i}=a.node().getBoundingClientRect(),o=r.WH().domain([0,1]).range([0,n]),s=e.copy().nice().domain(),c=l.cZ().pad([.1,.1]).padUnit("percent")(s),[h,u]=c,d=r.y17(h,u,(u-h)/i),g=r.m4Y().domain(c).range([i,0]),p=l.XM(l.WZ()).xScale(o).yScale(g).crossValue(0).baseValue((e,t)=>d[Math.max(0,t-1)]).mainValue(e=>e).decorate(t=>{t.selectAll("path").style("fill",t=>e(t))}),m=s[0]<0&&s[1]>0?0:Math.round((s[1]+s[0])/2),y=[...s,m],f=S(h,u),x=l.eH(g).tickValues(y).tickSizeOuter(0).tickFormat(e=>f(e)),v=Ht(a,"svg",()=>a.append("svg")).style("width",n).style("height",i),b=Ht(v,"g",()=>v.append("g")).datum(d).call(p),w=Math.abs(b.node().getBBox().x);Ht(v,"#legend-axis",()=>v.append("g").attr("id","legend-axis")).attr("transform",`translate(${w})`).datum(d).call(x).select(".domain").attr("visibility","hidden")}return t.scale=(...a)=>a.length?(e=a[0],t):e,t}function Za(){let e="element-prefix-unset",t=null,a=null,n=null,l=null,r=null,i=!0,o=null,s=s=>{let c=Ht(s,"div.outer-container",()=>s.append("div").attr("class","outer-container").style("width",`calc(100% - ${o??0})`).style("height",`calc(100% - ${o??0})`).style("padding-left",o??0)),h=Ht(c,"div.inner-container",()=>c.append("div").attr("class","inner-container")),u=c.node().getBoundingClientRect(),d=u.height,g=u.width-0,p=s.datum(),m=Math.max(1,Math.min(p.length,Math.floor(g/300))),y=Math.ceil(p.length/m);r={width:g/Math.max(m,1),height:Math.min(d,Math.max(d/y,g/Math.max(m,1)))},d/y>.75*r.height&&(r.height=d/y),p.length>1?(h.style("grid-template-columns",`repeat(${m}, ${100/m}%)`),h.style("grid-template-rows",`repeat(${y}, ${r.height}px)`)):(h.style("grid-template-columns","repeat(1, 100%)"),h.style("grid-template-rows","repeat(1, 100%)")),n=h.selectAll(`div.${e}-container`).data(p,e=>e.split),n.exit().remove(),a=n.enter().append("div").attr("class",`${e}-container`),l=a.append("div").attr("class","title-container").style("text-align","center").attr("display","inline-block").append("text").attr("class","title").style("text-align","left"),t=i?a.append("svg").append("g").attr("class",e):a.append("div").attr("class",e)};return s.padding=(...e)=>e.length?(o=e[0],s):o,s.svg=(...e)=>e.length?(i=e[0],s):i,s.elementsPrefix=(...t)=>t.length?(e=t[0],s):e,s.chartContainer=()=>t,s.chartEnter=()=>a,s.chartDiv=()=>n,s.chartTitle=()=>l,s.containerSize=()=>r,s}function Ja([e,t],[a,n]){let l=(n-t)/(a-e),r=n-l*a;return function(e){let a=e.node(),i=Math.min(a.clientWidth,a.clientHeight);return Math.min(n,Math.max(t,l*i+r))}}function Qa(){let e=null,t=null,a=null,n=null,r=r=>{let i=!!e.realValues[2],o=e.realValues[4],s=e.realValues[3]?Ka(0,t,"size").range([10,1e4]):null,c=e.realValues[5],h=Ja([600,.1],[1600,1])(r),u=l.Zm().mapping((e,t)=>e[t]).series(t.map(()=>Ea(e,o,s,a,c,n,h))),d=()=>q(e).settingName("mainValues").paddingStrategy(be()).pad([.1,.1]),g=d().settingValue(e.mainValues[0].name).memoValue(e.axisMemo[0]).valueName("x")(t),p=d().orient("vertical").settingValue(e.mainValues[1].name).memoValue(e.axisMemo[1]).valueName("y")(t),[m,y]=0===e.splitValues.length?[e.mainValues[0].name,e.mainValues[1].name]:["",""],f=K(g,p).xLabel(m).yLabel(y).plotArea(ve(u,e).canvas(!0));f.xNice&&f.xNice(),f.yNice&&f.yNice();let x=we().chart(f).settings(e).xScale(g.scale).yScale(p.scale).canvas(!0),v=Pe().scaleFactor(h).settings(e).canvas(!0).xScale(g.scale).xValueName("x").yValueName("y").yScale(p.scale).color(!i&&a).size(s).data(t);r.datum(t).call(x),r.call(v)};return r.settings=(...t)=>t.length?(e=t[0],r):e,r.data=(...e)=>e.length?(t=e[0],r):t,r.color=(...e)=>e.length?(a=e[0],r):a,r.symbols=(...e)=>e.length?(n=e[0],r):n,r}function en(e,t){if(!t)return;let a=e.realValues[4],n=e.mainValues.find(e=>e.name===a)?.type,l=t.domain(),i=t.range(),o=i.length;for(let[r,c]of l.entries())i[r]=i[r%o];let s=e.columns_config?.[a]?.symbols??{};return Object.entries(s).forEach(([e,t])=>{let a=He[t]??r.hKN,o=l.findIndex(t=>{switch(n){case"date":case"datetime":return new Date(t).valueOf()===new Date(e).valueOf();default:return String(t)===String(e)}});i[o]=a}),t.range(i),t}function tn(e,t){let a=t.realValues[2],n=!!a,l="string"===t.mainValues.find(e=>e.name===a)?.type,i=null,o=null,s=t.realValues[4],c=Ra(t,s),h=en(t,c),u=qa(t,Aa(t));if(n&&l?s?(i=t.splitValues.length>0?la(t,u):la(t,u[0]),o=fe().settings(t).scale(h)):(i=na(t,a),o=ye().settings(t).scale(i)):n?(i=Xa(t,u,"colorValue"),o=Ga().scale(i)):(i=ia().settings(t).domain([""])(),o=fe().settings(t).scale(h)),0!==t.splitValues.length){let a=Za().svg(!1).elementsPrefix("xy-scatter");a=a.padding("2.5em"),e.append("div").attr("class","multi-xlabel").append("p").text(t.mainValues[0].name),e.append("div").attr("class","multi-ylabel").append("p").text(t.mainValues[1].name).style("transform","rotate(-90deg)").style("text-wrap","nowrap"),(e=e.datum(u)).call(a);a.chartContainer();let n=a.chartEnter(),l=a.chartDiv(),o=a.chartTitle(),s=a.containerSize();o.each((e,t,a)=>r.Ltv(a[t]).text(e.key)),n.merge(l).attr("transform",`translate(${s.width/2}, ${s.height/2})`).each(function(e){let a=r.Ltv(this);Qa().settings(t).data([e]).color(i).symbols(h)(a)})}else Qa().settings(t).data(u).color(i).symbols(h)(e);o&&e.call(o)}tn.plugin={name:"X/Y Scatter",category:"X/Y Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Color","Size","Symbol","Label","Tooltip"]},selectMode:"toggle"},tn.can_render_column_styles=(e,t)=>"string"===e&&"Symbol"===t,tn.column_style_controls=(e,t)=>"string"===e&&"Symbol"===t?{symbols:{keys:"row",values:Object.keys(He)}}:null;var Fe=tn;function an(e,t){let a=l.sH();return a.decorate((e,a)=>{e.fillStyle=t(a.colorValue)}),l.XM(a).xValue(e=>e.crossValue).yValue(e=>e.mainValue).colorValue(e=>e.colorValue).colorInterpolate(t.interpolator()).widthFraction(1)}function nn(e,t){let a=ae(e),n=m(e).excludeType(p.linear).settingName("splitValues")(),l=[];return t.forEach((e,t)=>{let r=a(e,t);Object.keys(e).filter(e=>"__ROW_PATH__"!==e).forEach(t=>{let a=ln(t);l.push({crossValue:r,mainValue:n===p.time?new Date(a):a,colorValue:e[t],row:e})})}),l}function ln(e){let t=e.split("|");return t.pop(),t.join("|")}function rn(e,t){let a=nn(t,za(t)),n=Xa(t,a,"colorValue"),l=an(0,n),r=Ga().scale(n),i=q(t).excludeType(p.linear).settingName("crossValues").valueName("crossValue")(a),o=q(t).excludeType(p.linear).settingName("splitValues").valueName("mainValue").modifyDomain(e=>isNaN(e[0])?e:e.reverse()).orient("vertical")(a),s=K(i,o).plotArea(ve(l,t).canvas(!0));s.xPaddingInner&&(s.xPaddingInner(0),s.xPaddingOuter(0),l.xAlign("right")),s.yPaddingInner&&(s.yPaddingInner(0),s.yPaddingOuter(0),l.yAlign("top"));let c=we().chart(s).settings(t).xScale(i.scale).yScale(o.scale).canvas(!0),h=Pe().settings(t).canvas(!0).xScale(i.scale).yScale(o.scale).color(n).data(a);e.datum(a).call(c),e.call(r),e.call(h)}rn.plugin={name:"Heatmap",category:"Hierarchial Chart",max_cells:5e4,max_columns:500,render_warning:!0,initial:{names:["Color"]}};var Ye=rn;function on(e,t){return ha(e,t,{excludeEmpty:!0}).map(t=>sn(e,t))}function sn(e,t){let a=ae(e),n=t.map((n,l)=>{let r=e.realValues[0]?n[e.realValues[0]]:void 0,i=e.realValues[1]?n[e.realValues[1]]:(a=>t[a<t.length-1?a+1:a][e.realValues[0]])(l);return{crossValue:a(n,l),mainValues:e.mainValues.map(e=>n[e.name]),openValue:r,closeValue:i,highValue:e.realValues[2]?n[e.realValues[2]]:Math.max(r,i),lowValue:e.realValues[3]?n[e.realValues[3]]:Math.min(r,i),key:t.key,row:n}});return n.key=t.key,n}function cn(e,t,a){let n=a.domain(),r=ia().domain(n).settings(e).defaultColors([e.colorStyles["series-2"]]).mapFunction(ca(.5))(),i=ia().settings(e).domain(n)(),o=t().crossValue(e=>e.crossValue).openValue(e=>e.openValue).highValue(e=>e.highValue).lowValue(e=>e.lowValue).closeValue(e=>e.closeValue).decorate((e,t)=>{let n=(e=>e.closeValue>=e.openValue)(t)?a(t.key):r(t.key);e.fillStyle=n,e.strokeStyle=n}),s=l.aV().mainValue(e=>e.bollinger.average).crossValue(e=>e.crossValue).decorate((e,t)=>{e.strokeStyle=i(t[0].key)}),c=l.J2().mainValue(e=>e.bollinger.upper).baseValue(e=>e.bollinger.lower).crossValue(e=>e.crossValue).decorate((e,t)=>{e.fillStyle=ca(.25)(i(t[0].key))});return l.Zm().series([c,o,s])}function hn(e){return function(t,a){let n=on(a,Aa(a)),r=l.tG().value(e=>e.openValue),i=n.map(e=>{let t=r(e);return e.map((e,a)=>Object.assign({bollinger:t[a]},e))}),o=n.map(e=>e.key).concat(a.hideKeys?a.hideKeys:[]).sort(),s=ia().domain(o).settings(a).mapFunction(ca(1))(),c=ye().settings(a).scale(o.length>1?s:null),h=cn(a,e,s),u=l.Zm().mapping((e,t)=>e[t]).series(i.map(()=>h)),d=be().pad([.1,.1]).padUnit("percent"),g=q(a).settingName("crossValues").valueName("crossValue")(i),p=q(a).settingName("mainValues").valueNames(["lowValue","highValue"]).memoValue(a.axisMemo[1]).orient("vertical").paddingStrategy(d)(i),m=K(g,p).plotArea(ve(u,a).orient("vertical").canvas(!0));m.yNice&&m.yNice();let y=we().chart(m).settings(a).xScale(g.scale).onChange(e=>{let t=i.map(t=>t.filter(t=>t.crossValue>=e.xDomain[0]&&t.crossValue<=e.xDomain[1]));m.yDomain(p.domainFunction(t))}).canvas(!0),f=Pe().settings(a).xScale(g.scale).yScale(p.scale).yValueName("closeValue").color(s).data(i).canvas(!0);t.datum(i).call(y),t.call(f),t.call(c)}}var qe=hn,Ue=qe(l.ij);Ue.plugin={name:"OHLC",category:"Y Chart",max_cells:3500,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Open","Close","High","Low","Tooltip"]},selectMode:"toggle"};var Ke=Ue,Xe=qe(l.Xy);Xe.plugin={name:"Candlestick",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Open","Close","High","Low","Tooltip"]},selectMode:"toggle"};var Ge=Xe;function un(e,t){if(e.realValues.length>1&&null!==e.realValues[1]){let a=e.realValues[1];if("string"===e.mainValues.find(e=>e.name===a)?.type){return la(e,t.map(e=>e.data).filter(e=>e.height>0).map(e=>dn(e)).reduce((e,t)=>e.concat(t)))}return Xa(e,null,null,(e=>{let t=e=>(t,a)=>void 0===t?a:void 0===a?t:e(t,a);return e.reduce((e,a)=>[t(Math.min)(e[0],a[0]),t(Math.max)(e[1],a[1])],[void 0,void 0])})(t.map(e=>e.extents)))}}function dn(e,t=[]){return e.children&&e.children.length>0?e.children.forEach(e=>t.concat(dn(e,t))):e.data.color&&t.push(e.data.color),t}function gn(e){let t={},a=e.realValues.map(t=>null===t?null:e.mainValues.find(e=>e.name===t));return e.data.forEach((n,l)=>{let r=Array.isArray(n.__ROW_PATH__)?n.__ROW_PATH__:[];mn(n).forEach(i=>{let o;t[i]||(t[i]=[]),o=t[i],r.forEach((t,s)=>{let c=o.find(e=>e.name===t);if(c||(c={name:t,children:[]},o.push(c)),e.realValues.length>1&&null!==e.realValues[1]){let t=s===r.length-1,a=Ze(t?n:e.agg_paths[l][s+1]||n,e.mainValues[1],i);void 0!==a&&(c.color=a)}if(e.realValues.length>2&&null!==e.realValues[2]){c.tooltip=[];for(let t=2;t<e.realValues.length;++t)c.tooltip.push(Ze(n,a[t],i))}if(s===r.length-1)if(c.name=r.slice(-1)[0],0===e.crossValues.length)c.size=Ze(n,e.mainValues[0],"");else if(r.length===e.crossValues.length){let t=Ze(n,e.mainValues[0],i);c.size=t>0?t:0}o=c.children})})}),Object.entries(t).map(t=>{let a={name:"root",children:t[1]},n=r.Sk5(a).sum(e=>e.size),l=r.jBG().size([2*Math.PI,n.height+1])(n);return l.each(a=>{a.current=a,a.mainValues=1===e.realValues.length||null===e.realValues[1]&&null===e.realValues[2]?a.value:[a.value,a.data.color].concat(a.data.tooltip||[]).filter(e=>void 0!==e),a.crossValue=a.ancestors().slice(0,-1).reverse().map(e=>e.data.name),a.key=t[0],a.label=Wt(e.crossValues[a.depth-1<0?0:a.depth-1]?.type||e.mainValues[0].type,a.data.name)}),{split:t[0],data:l,extents:pn(e,t)}})}var Ze=(e,t,a)=>a.length?e[`${a}|${t.name}`]:e[t.name];function pn(e,[t,a]){if(e.realValues.length>1&&null!==e.realValues[1]){return[Math.min(...e.data.map(a=>Ze(a,e.mainValues[1],t))),Math.max(...a.map(e=>e.color))]}}function mn(e){let t=[];return Object.keys(e).forEach(e=>{if("__ROW_PATH__"!==e){let a=e.split("|").slice(0,-1).join("|");t.includes(a)||t.push(a)}}),t}var Je=e=>(0,r.JLW)().startAngle(e=>e.x0).endAngle(e=>e.x1).padAngle(e=>Math.min((e.x1-e.x0)/2,.005)).padRadius(e).innerRadius(t=>Math.max(1,(t.y0-1)*e)).outerRadius(t=>Math.max((t.y0-1)*e,(t.y1-1)*e-1)),Qe=e=>e.y0>=1&&e.x1>e.x0,et=e=>e.y1<=3&&e.y0>=1&&(e.y1-e.y0)*(e.x1-e.x0)>.06;function yn(e,t){let a=(e.x0+e.x1)/2*180/Math.PI;return`rotate(${a-90}) translate(${(e.y0-1+(e.y1-1))/2*t},0) rotate(${a<180?0:180})`}function fn(e,t){let a=this.getBBox().width;if(a>t){let n=e.label,l=(0,r.Ltv)(this);for(;a>t;)n=n.substring(0,n.length-1),l.text(()=>n),a=this.getBBox().width;l.text(()=>`${n.substring(0,n.length-3).replace(/\s+$/,"")}...`)}}var tt=(e,t,a,n,l,i,o,s,c)=>(h,u)=>{c.sunburstLevel[s]=h.data.name,h.parent?(a.datum(h.parent),a.style("cursor","pointer"),n.html(`&#8682; ${h.label}`)):(a.datum(e),a.style("cursor","default"),n.html("")),e.each(e=>e.target={x0:2*Math.max(0,Math.min(1,(e.x0-h.x0)/(h.x1-h.x0)))*Math.PI,x1:2*Math.max(0,Math.min(1,(e.x1-h.x0)/(h.x1-h.x0)))*Math.PI,y0:Math.max(0,e.y0-h.depth),y1:Math.max(0,e.y1-h.depth)});let d=t.transition().duration(u?0:750);l.transition(d).tween("data",e=>{let t=(0,r.GWP)(e.current,e.target);return a=>e.current=t(a)}).filter(function(e){return+this.getAttribute("fill-opacity")||Qe(e.target)}).attr("fill-opacity",e=>Qe(e.target)?1:0).attr("user-select",e=>Qe(e.target)?"initial":"none").style("pointer-events",e=>Qe(e.target)?"initial":"none").attrTween("d",e=>()=>Je(o)(e.current)),i.filter(function(e){return+this.getAttribute("fill-opacity")||et(e.target)}).transition(d).attr("fill-opacity",e=>+et(e.target)).attrTween("transform",e=>()=>yn(e.current,o))};function xn(){let e=null,t=null,a=null,n=null,l=null,r=r=>{let i=r.selectAll("g.segment").data(a.descendants().slice(1)),o=i.enter().append("g").attr("class","segment");o.append("path"),o.append("text").attr("class","segment").attr("dy","0.35em");let s=o.merge(i),c=s.select("path").attr("fill-opacity",e=>Qe(e.current)?1:0).attr("user-select",e=>Qe(e.current)?"initial":"none").style("pointer-events",e=>Qe(e.current)?"initial":"none").attr("d",e=>Je(l)(e.current));n&&c.style("fill",e=>n(e.data.color));let h=s.select("text").attr("fill-opacity",e=>+et(e.current)).attr("transform",e=>yn(e.current,l)).text(e=>e.label).each(function(e){fn.call(this,e,l)}),u=r.select("text.parent"),d=r.select("circle").attr("r",l).datum(a),g=tt(a,r,d,u,c,h,l,t,e);if(e.sunburstLevel){let n=a.descendants().find(a=>a.data.name===e.sunburstLevel[t]);n&&g(n,!0)}else e.sunburstLevel={};d.on("click",e=>g(e,!1)),c.filter(e=>e.children).style("cursor","pointer").on("click",e=>g(e,!1))};return r.settings=(...t)=>t.length?(e=t[0],r):e,r.split=(...e)=>e.length?(t=e[0],r):t,r.data=(...e)=>e.length?(a=e[0],r):a,r.color=(...e)=>e.length?(n=e[0],r):n,r.radius=(...e)=>e.length?(l=e[0],r):l,r}function vn(e,t){let a=gn(t),n=un(t,a),l=Za().elementsPrefix("sunburst");if(e.datum(a).call(l),n){let a=t.realValues[1];if("string"===t.mainValues.find(e=>e.name===a)?.type){let a=ye().settings(t).scale(n);e.call(a)}else{let t=Ga().scale(n);e.call(t)}}let i=l.chartContainer(),o=l.chartEnter(),s=l.chartDiv(),c=l.chartTitle(),h=l.containerSize();c.each((e,t,a)=>r.Ltv(a[t]).text(e.split)),i.append("circle").attr("fill","none").style("pointer-events","all"),i.append("text").attr("class","parent"),o.merge(s).select("svg").select("g.sunburst").attr("transform",`translate(${h.width/2}, ${h.height/2})`).each(function({split:e,data:a}){let l=r.Ltv(this),i=this.parentNode,{width:o,height:s}=i.getBoundingClientRect(),c=(Math.min(o,s)-24)/Math.max(2,2*t.crossValues.length);xn().settings(t).split(e).data(a).color(n).radius(c)(l),Q().settings(t)(l.selectAll("g.segment"))})}vn.plugin={name:"Sunburst",category:"Hierarchial Chart",max_cells:7500,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};var at=vn;function bn(e,t){if(e.realValues.length<1||null===e.realValues[1]||void 0===e.realValues[1])return;let a=e.realValues[1],n=t.filter(e=>e.height>0).map(e=>wn(e)).reduce((e,t)=>e.concat(t));if("string"===e.mainValues.find(e=>e.name===a)?.type)return la(e,n);return Xa(e,null,null,[Math.min(...n),Math.max(...n)])}function wn(e,t=[]){return e.children&&e.children.length>0?e.children.forEach(e=>t.concat(wn(e,t))):e.data.color&&t.push(e.data.color),t}var nt=e=>!(!e.target||!e.target.textAttributes),lt=(e,t,a)=>{e.selectAll("text").each(function(e,n){let l=gt(e,t,a);this.style=l});let n=ot(e);ct(n),rt(n)},rt=e=>{let t=e=>e.getBoundingClientRect(),a=[];e.selectAll("text").filter((e,t,a)=>(0,r.Ltv)(a[t]).attr("style")===pt.high).each((e,t,n)=>a.push(n[t])),e.selectAll("text").filter((e,t,a)=>(0,r.Ltv)(a[t]).attr("style")===pt.low).each((e,n,l)=>{let i=l[n];a.filter(e=>Dt("x",t(e),t(i))&&Dt("y",t(e),t(i),-2)).forEach(()=>(0,r.Ltv)(i).attr("dy",Number((0,r.Ltv)(i).attr("dy"))+14))})},it={top:1,mid:.7,lower:0},ot=e=>e.filter((e,t,a)=>(0,r.Ltv)(a[t]).selectAll("text").attr("style")!==pt.zero),st=e=>e.selectAll("text").each((e,t,a)=>ut(a[t])),ct=e=>e.selectAll("text").each((e,t,a)=>ht(a[t])),ht=e=>{let t=(0,r.Ltv)(e),a=e.getBoundingClientRect();t.attr("dx",0-a.width/2).attr("dy",0+a.height/4)},ut=e=>{let t=e.parentNode.childNodes[0],a=e.getBBox(),n=t.getBBox();dt(e,n,a)||(0,r.Ltv)(e).attr("style",(0,r.Ltv)(e).attr("style"))},dt=(e,t,a)=>{let n=Math.min(t.height/a.height,t.width/a.width);if(n<1){let t=parseInt((0,r.Ltv)(e).style("font-size")),a=Math.floor(t*n);return t>7&&a>7?((0,r.Ltv)(e).style("font-size",`${a}px`),ht(e)):((0,r.Ltv)(e).style("font-size",null),(0,r.Ltv)(e).style("opacity","0")),!0}return!1},gt=(e,t,a)=>{if(!a.filter(e=>""!==e).every(t=>e.crossValue.includes(t)))return pt.zero;switch(e.depth){case t+1:return pt.high;case t+2:return pt.low;default:return pt.zero}},pt={high:"font-size:14px;z-index:5;pointer-events: none;",low:"font-size:8px;opacity:0.7;z-index:4;",zero:"font-size:0px;opacity:0;z-index:4;"},mt=(e,t)=>{let a=r.hkb().size([e,t]).paddingInner(e=>1+2*(e.height-1));return a.tile(r.GaH),a};function Vn(e,t,a,n,l,r){kn(e,t,a,n,l),e.mapLevel[n].levelRoot=!0,Sn(e,r.node().getBoundingClientRect().width,r.node().getBoundingClientRect().height,n),zn(a,n)}function _n(e,t){e.each(e=>{e.mapLevel=[],e.mapLevel[0]={x0:e.x0,x1:Vt(e)+e.x0,y0:e.y0,y1:_t(e)+e.y0,visible:!0,opacity:1}}),t.mapLevel[0].levelRoot=!0,zn(e,0)}var yt=(e,t)=>{e.each((e,a,n)=>{let l=(0,r.Ltv)(n[a]).selectAll("text");e.mapLevel[t].textAttributes={dx:l.attr("dx"),dy:l.attr("dy"),class:l.attr("class"),"font-size":l.style("font-size")}})};function kn(e,t,a,n,l){let r=e.x0,i=e.y0,o=e.x1-e.x0,s=e.y1-e.y0,c=l.x1-l.x0,h=l.y1-l.y0,u=c/o,d=h/s;a.each(e=>{let a=(e.x0-r)*u,l=(e.y0-i)*d,o=Vt(e)*u,s=_t(e)*d,c=((e,t)=>t.every(t=>e.crossValue.includes(t)))(e,t)&&e.data.name!==t[n-1];e.mapLevel[n]={x0:a,x1:o+a,y0:l,y1:s+l,visible:c,opacity:c?1:0}}),e.mapLevel[n].levelRoot=!0}function Sn(e,t,a,n){let l=mt(t,a)((0,r.Sk5)(e.data).sum(e=>e.size)).descendants(),i=e.descendants();l.forEach((e,t)=>{i[t].mapLevel[n].x0=l[t].x0,i[t].mapLevel[n].x1=l[t].x1,i[t].mapLevel[n].y0=l[t].y0,i[t].mapLevel[n].y1=l[t].y1})}function zn(e,t){e.selectAll("text").each((e,a,n)=>{let l=(0,r.Ltv)(n[a]),i=(0,r.Ltv)(n[a]).datum(),o=l.attr("class");i.mapLevel[t].textLockedAt={opacity:it[o]}})}function An(e,t,a,n,l,r,i,o,s){if(n.treemapLevel>0){let c=i.crossValue;Ln(i,e,t,a,n,l,r,i,0,c,o,s,1,!1),n.treemapRoute.slice(1,n.treemapRoute.length).forEach(c=>{let h=t.filter(e=>e.crossValue===c).datum(),u=h.crossValue;Vn(h,u,t,h.depth,i,l),Ln(h,e,t,a,n,l,r,i,h.depth,u,o,s,1,!1)})}}function Mn(e,t,a,n,l,r,i,o,s,c){if(!e.children)return;l.treemapLevel<e.depth?l.treemapRoute.push(e.crossValue):l.treemapRoute.pop(),l.treemapLevel=e.depth;let h=e.crossValue;(!e.mapLevel[l.treemapLevel]||!e.mapLevel[l.treemapLevel].levelRoot)&&Vn(e,h,a,l.treemapLevel,o,r),Ln(e,t,a,n,l,r,i,o,l.treemapLevel,h,s,c)}function Ln(e,t,a,n,l,i,o,s,c,h,u,d,g=500,p=!0){let m=e.parent,y=o.transition("main transition").duration(g).ease(r.TD8);a.each(e=>e.target=e.mapLevel[c]),nt(e)||vt(a,u),a.transition(y).tween("data",e=>{let t=r.GWP(e.current,e.target);return a=>e.current=t(a)}).styleTween("opacity",e=>()=>e.current.opacity).attrTween("pointer-events",e=>()=>e.target.visible?"all":"none"),t.transition(y).filter(e=>e.target.visible).styleTween("x",e=>()=>`${e.current.x0}px`).styleTween("y",e=>()=>`${e.current.y0}px`).styleTween("width",e=>()=>e.current.x1-e.current.x0+"px").styleTween("height",e=>()=>e.current.y1-e.current.y0+"px"),n.transition(y).filter(e=>e.target.visible).attrTween("x",e=>()=>e.current.x0+Vt(e.current)/2).attrTween("y",e=>()=>e.current.y0+_t(e.current)/2).end().catch(()=>bt(a)).then(()=>{nt(e)||(rt(f),st(f),Nn(n,o,g),p&&yt(a,c),bt(a,u))}).catch(e=>{console.error("Exception completing promises after main transition",e),bt(a,u)}),nt(e)?(e=>{e.each((e,t,a)=>{(0,r.Ltv)(a[t]).selectAll("text").attr("dx",e.target.textAttributes.dx).attr("dy",e.target.textAttributes.dy).attr("style",e.target.textAttributes.style)})})(a):(n.each((e,t,a)=>(e=>(0,r.Ltv)(e).style("opacity",it[(0,r.Ltv)(e).attr("class")]))(a[t])),lt(a,c,h));let f=ot(a);m?u.hide(!1).text(e.label).onClick(()=>{Mn(m,t,a,n,l,i,o,s,u,d);let e=i.node().getRootNode().host.parentElement;J(e,m,d)})():u.hide(!0)()}async function Nn(e,t,a=400){let n=t.transition("text fade transition").duration(a).ease(r.TD8);await e.transition(n).filter(e=>e.target.visible).tween("data",(e,t,a)=>{let n=a[t],l=r.GWP(ft(e),xt(n));return t=>e.current.opacity=l(t)}).styleTween("opacity",e=>()=>e.current.opacity).end().catch(e=>console.error("Exception in text fade transition",e)).then(()=>e.each((e,t,a)=>(e=>(0,r.Ltv)(e).style("opacity",null))(a[t])))}var ft=e=>e.target.textLockedAt.opacity,xt=e=>it[r.Ltv(e).attr("class")],vt=(e,t)=>{t.deactivate(!0),e.each((e,t,a)=>{r.Ltv(a[t]).selectAll("rect").style("pointer-events","none")})},bt=(e,t=void 0)=>{t&&t.deactivate(!1),e.each((e,t,a)=>{r.Ltv(a[t]).selectAll("rect").style("pointer-events",null)})};function $n(e){let t=null,a=null,n=!0,l=!1,r=Ht(e,".parent-controls",()=>e.append("div").attr("class","parent-controls").style("display",n?"none":"").html('<button id="goto-parent">Goto parent</button>\n')),i=()=>{r.style("display",n?"none":"").select("#goto-parent").style("pointer-events",l?"none":null).html(`\u21ea ${a}`).on("click",()=>t())};return i.deactivate=(...e)=>{if(!e.length)return l;l=e[0];let t=r.select("#goto-parent");return l?t.style("pointer-events","none"):t.style("pointer-events",null),i},i.hide=(...e)=>e.length?(n=e[0],i):n,i.text=(...e)=>e.length?(a=e[0],i):a,i.onClick=(...e)=>e.length?(t=e[0],i):t,i}var wt={leaf:"leafnode",branch:"branchnode",root:"rootnode"},Vt=e=>e.x1-e.x0,_t=e=>e.y1-e.y0,kt=(e,t)=>0===t.depth?wt.root:((e,t)=>t.depth===e)(e,t)?wt.leaf:wt.branch;function Tn(){let e=null,t=null,a=null,n=null,l=null,r=null,i=i=>{r=$n(l),r();let o=a.height;e.treemapLevel||(e.treemapLevel=0),e.treemapRoute||(e.treemapRoute=[]),mt(l.node().getBoundingClientRect().width,l.node().getBoundingClientRect().height)(a);let s=i.selectAll("g").data(a.descendants()),c=s.enter().append("g");c.append("rect"),c.append("text");let h=c.merge(s).sort((e,t)=>t.depth-e.depth),u=h.select("rect").attr("class",e=>`treerect ${kt(o,e)}`).style("x",e=>`${e.x0}px`).style("y",e=>`${e.y0}px`).style("width",e=>`${Vt(e)}px`).style("height",e=>`${_t(e)}px`);u.style("fill",e=>kt(o,e)===wt.leaf?e.data.color?n(e.data.color):t.colorStyles.series:"transparent");let d=h.filter(e=>0!==e.value).select("text").attr("x",e=>e.x0+Vt(e)/2).attr("y",e=>e.y0+_t(e)/2).text(e=>e.label),g=u.filter(e=>0===e.crossValue.length).datum();_n(h,g),lt(h,0,[]),st(ot(h)),yt(h,0),0===e.treemapRoute.length&&e.treemapRoute.push(g.crossValue),u.filter(e=>e.children).on("click",(a,n)=>Mn(n,u,h,d,e,l,i,g,r,t)),An(u,h,d,e,l,i,g,r,t)};return i.settings=(...a)=>a.length?(e=a[0],t=a[1],i):e,i.data=(...e)=>e.length?(a=e[0],i):a,i.color=(...e)=>e.length?(n=e[0],i):n,i.container=(...e)=>e.length?(l=e[0],i):l,i}function Pn(e,t){t.treemaps||(t.treemaps={});let a=gn(t),n=bn(t,a.map(e=>e.data));n&&this._container.classList.add("has-legend");let l=Za().elementsPrefix("treemap");if(e.datum(a).call(l),n){let a=t.realValues[1];if("string"===t.mainValues.find(e=>e.name===a)?.type){let a=ye().settings(t).scale(n);e.call(a)}else{let t=Ga().scale(n);e.call(t)}}let i=l.chartEnter(),o=l.chartDiv();l.chartTitle().each((e,t,a)=>r.Ltv(a[t]).text(e.split)),i.merge(o).select("svg").select("g.treemap").each(function({split:e,data:a}){let l=r.Ltv(this);t.treemaps[e]||(t.treemaps[e]={}),Tn().settings(t.treemaps[e],t).data(a).container(r.Ltv(r.Ltv(this.parentNode).node().parentNode)).color(n)(l),Q().settings(t).centered(!0)(l.selectAll("g"))})}Pn.plugin={type:"Treemap",name:"Treemap",category:"Hierarchial Chart",max_cells:3e3,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};var St=[Ve,Ne,Ce,Be,De,We,Fe,Ke,Ge,Pn,at,Ye],zt=(e,t)=>{if(!t.colorStyles){let a={scheme:[],gradient:{},interpolator:{},grid:{}},n=Lt(e);a.series=n("--d3fc-series");for(let e=1;;e++){let t=`series-${e}`,l=n(`--d3fc-${t}`);if(!l)break;a[t]=l,a.scheme.push(l)}a.opacity=At(a.series),a.grid.gridLineColor=n`--d3fc-gridline--color`,["full","positive","negative"].forEach(e=>{let t=n(`--d3fc-${e}--gradient`);a.gradient[e]=Nt(t,a.opacity)}),t.colorStyles=a}if(!t.textStyles){let a=window.getComputedStyle(e),n=a.getPropertyValue("color"),l=`12px ${a.getPropertyValue("font-family")}`;t.textStyles={color:n,font:l}}},At=e=>r.yWT(e).opacity,Mt=(e,t)=>{let a=r.yWT(`#${e}`);return a.opacity=t,a+""},Lt=e=>{let t=getComputedStyle(e);return e=>t?.getPropertyValue(e)},Nt=(e,t)=>{let a=c.q(e)[0].colorStops;return a.map((e,n)=>[e.length?e.length.value/100:n/(a.length-1),Mt(e.value,t)]).sort((e,t)=>e[0]-t[0])},$t={initial:{type:"number",count:1,names:[]},selectMode:"select"},Tt=[h.A,u.A,':host{user-select:none;}:host .chart{position:absolute;box-sizing:border-box;left:0;top:0;width:100%;height:100%;padding:12px;overflow:hidden;}:host .chart.yline .y-series:not(:first-child) .gridline-x{display:none;}:host .chart text{font-family:var(--interface-monospace--font-family);}:host .chart.heatmap d3fc-group.cartesian-chart,:host .chart.treemap d3fc-group.cartesian-chart{grid-template-columns:minmax(0em,max-content) auto 1fr auto minmax(0em,max-content);grid-template-rows:minmax(0em,max-content) auto 1fr auto minmax(0em,max-content);}:host .chart .chart-label{display:none;}:host .chart.heatmap{padding-right:120px;}:host .chart.xyscatter{padding:0;font-size:14px;}:host .chart.xyscatter d3fc-group:first-child{padding:16px;padding-top:0px;width:calc(100% - 32px);height:calc(100% - 16px);}:host .chart.xyscatter .multi-xlabel{position:absolute;bottom:0;height:2.5em;width:100%;display:flex;justify-content:center;align-items:center;background:var(--d3fc-legend--background);}:host .chart.xyscatter .multi-ylabel{position:absolute;top:0;width:2.5em;height:100%;display:flex;justify-content:center;align-items:center;background:var(--d3fc-legend--background);}:host .chart.xyscatter .outer-container{height:100%;}:host .chart.xyscatter .inner-container{display:inline-grid;overflow-y:auto;width:calc(100% - 16px);height:100%;padding:0;margin:0;}:host .chart.xyscatter .inner-container div{overflow:hidden;}:host .chart.xyscatter .inner-container text.segment,:host .chart.xyscatter .inner-container text.parent{text-anchor:middle;user-select:none;pointer-events:none;fill:var(--d3fc-treedata--labels,rgb(51,51,51));}:host .chart.xyscatter .inner-container div.xy-scatter-container{margin:5px 0;}:host .chart.sunburst{padding:0;font-size:14px;}:host .chart.sunburst .outer-container{height:100%;}:host .chart.sunburst .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto;}:host .chart.sunburst .inner-container div{overflow:hidden;}:host .chart.sunburst .inner-container .sunburst-container:not(:only-child) svg{transform:translate(0,-27px);}:host .chart.sunburst .inner-container svg{width:100%;height:100%;}:host .chart.sunburst .inner-container path{fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host .chart.sunburst .inner-container text.segment,:host .chart.sunburst .inner-container text.parent{text-anchor:middle;user-select:none;pointer-events:none;fill:var(--d3fc-treedata--labels,rgb(51,51,51));}:host .chart.sunburst .inner-container div.title-container{margin-top:5px;}:host .chart.has-legend{padding-right:120px;}:host .chart.treemap .treemap-container{position:relative;}:host .chart.treemap .treemap-container:not(:only-child){width:calc(100% - 12px);height:calc(100% - 12px);}:host .chart.treemap .outer-container{height:100%;}:host .chart.treemap .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto;}:host .chart.treemap .inner-container div{overflow:hidden;}:host .chart.treemap .inner-container svg{width:100%;height:100%;}:host .chart.treemap .inner-container .treerect{stroke:var(--d3fc-treedata-axis--lines,var(--d3fc-axis--lines,white));fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host .chart.treemap .inner-container .treerect:hover{cursor:pointer;stroke:var(--d3fc-treedata--hover-highlight,black);stroke-opacity:1;}:host .chart.treemap .inner-container .rootnode{opacity:0;pointer-events:none;z-index:0;}:host .chart.treemap .inner-container .branchnode{opacity:0;}:host .chart.treemap .inner-container .branchnode:hover{fill-opacity:0.1;opacity:1;fill:var(--d3fc-treedata--hover-highlight,black);}:host .chart.treemap .inner-container .leafnode{fill-opacity:0.8;}:host .chart.treemap .inner-container .leafnode:hover{fill-opacity:0.5;}:host .chart.treemap .inner-container #hidden{opacity:0;pointer-events:none;z-index:0;}:host .chart.treemap .inner-container .top{font-size:14px;z-index:5;pointer-events:none;}:host .chart.treemap .inner-container .mid{font-size:8px;opacity:0.7;z-index:4;}:host .chart.treemap .inner-container .lower{font-size:0px;opacity:0;z-index:4;}:host .chart.treemap .inner-container text{fill:var(--d3fc-treedata--labels,rgb(51,51,51));}:host .chart.treemap .inner-container text.title{dominant-baseline:hanging;}:host .chart.treemap .inner-container .parent-controls{position:absolute;top:12px;right:auto;left:30px;width:auto;z-index:4;transition:box-shadow 1s;}:host .chart.treemap .inner-container .parent-controls:hover{box-shadow:2px 2px 6px#000;transition:box-shadow 0.2s;}:host .chart .x-label{height:1.2em!important;line-height:1em!important;}:host .chart .x-label,:host .chart .y-label{color:var(--d3fc-label--color,inherit);font-size:14px;}:host .chart d3fc-canvas.plot-area{display:none;}:host .chart.xyscatter d3fc-canvas.plot-area,:host .chart.xyline d3fc-canvas.plot-area,:host .chart.ohlc d3fc-canvas.plot-area,:host .chart.candlestick d3fc-canvas.plot-area,:host .chart.heatmap d3fc-canvas.plot-area{display:block;}:host .chart .y-axis text,:host .chart .y2-axis text,:host .chart .x-axis text{fill:var(--d3fc-axis-ticks--color,rgb(80,80,80));font-size:11px;}:host .chart .y-axis path,:host .chart .y2-axis path,:host .chart .x-axis path{stroke:var(--d3fc-axis--lines,rgb(180,210,225));}:host .chart .splitter-label{display:inline-block;margin:0 10px;cursor:pointer;}:host .chart .splitter-label::after{margin-left:5px;color:var(--d3fc-axis--lines,rgb(180,210,225));}:host .chart .splitter-label:hover::after{color:var(--d3fc-axis-ticks--color,rgb(80,80,80));}:host .chart .splitter-label.disabled::after{color:rgba(80,80,80,0.3);}:host .chart .splitter-label.disabled{cursor:default;}:host .chart .y-label.left-label .splitter-label::after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:16px;height:12px;-webkit-mask-image:var(--sort-desc-icon--mask-image);mask-image:var(--sort-desc-icon--mask-image);}:host .chart .y-label.right-label .splitter-label::after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:16px;height:12px;-webkit-mask-image:var(--sort-asc-icon--mask-image);mask-image:var(--sort-asc-icon--mask-image);}:host .chart.ybar .y-axis path,:host .chart.yline .y-axis path,:host .chart.xyline .y-axis path,:host .chart.ybar .y2-axis path,:host .chart.yline .y2-axis path,:host .chart.xyline .y2-axis path,:host .chart.xyline .x-axis path,:host .chart.yarea .y-axis path,:host .chart.yscatter .y-axis path,:host .chart.xyscatter .y-axis path,:host .chart.yarea .y2-axis path,:host .chart.yscatter .y2-axis path,:host .chart.xyscatter .y2-axis path,:host .chart.xyscatter .x-axis path,:host .chart.xbar .x-axis path{visibility:hidden;}:host .chart .y-label{white-space:nowrap;}:host .chart .nearbyTip{fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host #dragHandles{position:absolute;top:0px;right:0px;left:auto;pointer-events:none;}:host #dragHandles rect{pointer-events:all;}:host .label rect{fill:none;}:host .legend-container{position:absolute;top:12px;right:12px;left:auto;width:150px;height:280px;}:host .legend-container.legend-color{width:90px;height:150px;}:host .legend-container[borderbox-on-hover="true"]{transition:box-shadow 1s;}:host .legend-container[borderbox-on-hover="true"]:hover{background-color:var(--d3fc-legend--background,#ffffff);transition:box-shadow 0.2s,background-color 0.2s;}:host .legend-container .legend{font-size:8pt;width:100%;}:host .legend-container .legend .cell{cursor:pointer;}:host .legend-container .legend .cell path{fill:var(--d3fc-series,rgba(31,119,180,0.5));stroke:var(--d3fc-series,rgb(31,119,180));}:host .legend-container .legend .cell.hidden path{fill:rgba(204,204,204,0.5);stroke:rgb(204,204,204);}:host .legend-container .legend .cell.hidden circle{fill:rgb(204,204,204)!important;}:host .legend-container text{fill:var(--d3fc-legend--text,rgb(51,51,51));}:host .legend-container .label:hover{fill:rgb(34,160,206);}:host .legend-container #legend-axis path{stroke:var(--d3fc-legend--text,rgb(51,51,51));}:host .legend-container .legend-controls{margin-left:12px;}:host .legend-container .legend-controls #up-arrow,:host .legend-container .legend-controls #down-arrow{cursor:pointer;color:rgb(31,119,180);}:host .legend-container .legend-controls #up-arrow.disabled,:host .legend-container .legend-controls #down-arrow.disabled{cursor:default;color:rgb(51,51,51);}:host .heatmap .legend-container.legend-color{height:200px;}:host .treemap .legend-container.legend-color{height:200px;}:host .treemap .legend-container:not(.legend-color){width:100px;}:host .zoom-controls{position:absolute;top:10px;left:0;width:100%;text-align:center;}:host .zoom-controls button{-webkit-appearance:none;background:var(--plugin--background,rgb(247,247,247));border:1px solid var(--inactive--color,rgb(204,204,204));color:var(--d3fc-label--color,inherit);font-size:12px;padding:8px;opacity:0.5;cursor:pointer;}:host .zoom-controls button:hover{opacity:1;}:host .parent-controls{position:absolute;top:30px;right:145px;width:100%;text-align:right;}:host .parent-controls button{-webkit-appearance:none;background:rgb(247,247,247);border:1px solid rgb(204,204,204);padding:10px;opacity:0.5;cursor:pointer;}:host .parent-controls button:hover{background:rgb(230,230,230);}:host div.tooltip{position:absolute;text-align:left;font-size:12px;font-weight:300;white-space:nowrap;padding:0.5em;background:var(--d3fc-tooltip--background,#ffffff);color:var(--d3fc-tooltip--color,black);border:1px solid var(--d3fc-tooltip--border-color,#777777);box-shadow:var(--d3fc-tooltip--box-shadow,none);pointer-events:none;}:host div.tooltip ul{margin:0;padding:0;list-style-type:none;}'].map(e=>{let t=new CSSStyleSheet;return t.replaceSync(e),t}),Pt=["crossValues","mainValues","realValues","splitValues","filter","data","size","colorStyles","textStyles","agg_paths","treemaps","axisMemo","columns_config"];async function Cn(e){await customElements.get("perspective-viewer").registerPlugin(e)}function En(...e){let t=new Set(e.length>0?e:St.map(e=>e.plugin.name));St.forEach(e=>{if(t.has(e.plugin.name)){let t=`perspective-viewer-d3fc-${e.plugin.name.toLowerCase().replace(/[ \t\r\n\/]*/g,"")}`;customElements.define(t,class extends Ct{_chart=e;static _chart=e}),customElements.whenDefined("perspective-viewer").then(()=>Cn(t))}})}Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector);var Ct=class extends HTMLElement{_chart;static _chart;_settings;render_warning;_initialized;_container;_staged_view;config;constructor(){super(),this._settings=null,this.render_warning=!0}connectedCallback(){if(!this._initialized){this.attachShadow({mode:"open"});for(let e of Tt)this.shadowRoot.adoptedStyleSheets.push(e);this.shadowRoot.innerHTML+='<div id="container" class="chart"></div>',this._container=this.shadowRoot.querySelector(".chart"),this._initialized=!0}}get name(){return this._chart.plugin.name}get category(){return this._chart.plugin.category}get select_mode(){return this._chart.plugin.selectMode||"select"}get min_config_columns(){return this._chart.plugin.initial?.count||$t.initial.count}get config_column_names(){return this._chart.plugin.initial?.names||$t.initial.names}static get max_cells(){return this._chart.plugin.max_cells||1e4}static set max_cells(e){this._chart.plugin.max_cells=e}static get max_columns(){return this._chart.plugin.max_columns||50}static set max_columns(e){this._chart.plugin.max_columns=e}get max_cells(){return this._chart.plugin.max_cells||1e4}set max_cells(e){this._chart.plugin.max_cells=e}get max_columns(){return this._chart.plugin.max_columns||50}set max_columns(e){this._chart.plugin.max_columns=e}can_render_column_styles(e,t){return this._chart.can_render_column_styles?.call(this,e,t)}column_style_controls(e,t){return this._chart.column_style_controls?.call(this,e,t)}async render(){var e=document.createElement("canvas"),t=this.shadowRoot.querySelector("#container");e.width=t.offsetWidth,e.height=t.offsetHeight;let a=e.getContext("2d");a.fillStyle=window.getComputedStyle(this).getPropertyValue("--plugin--background")||"white",a.fillRect(0,0,e.width,e.height);let n=window.getComputedStyle(this).getPropertyValue("color"),l=Array.from(this.shadowRoot.querySelectorAll("svg:not(#dragHandles)"));for(let s of l.reverse()){var r=document.createElement("img");let e=0;r.width=s.parentElement?s.parentElement.offsetWidth:e,r.height=s.parentElement?s.parentElement.offsetHeight:e;let t=s.cloneNode(!0);t.hasAttribute("viewBox")||t.setAttribute("viewBox",`0 0 ${r.width} ${r.height}`),t.setAttribute("xmlns","http://www.w3.org/2000/svg");for(let a of t.querySelectorAll("text"))a.setAttribute("fill",n);var i=(new XMLSerializer).serializeToString(t);i=i.replace(/[^\x00-\x7F]/g,"");let l=new Promise((e,t)=>{r.onload=e,r.onerror=t});try{r.src=`data:image/svg+xml;base64,${btoa(i)}`,await l}catch{let e=new Promise((e,t)=>{r.onload=e,r.onerror=t});r.src=`data:image/svg+xml;utf8,${i}`,await e}a.drawImage(r,s.parentNode.offsetLeft,s.parentNode.offsetTop,r.width,r.height)}let o=Array.from(this.shadowRoot.querySelectorAll("canvas"));for(let s of o.reverse())a.drawImage(s,s.parentNode.offsetLeft,s.parentNode.offsetTop,s.width/window.devicePixelRatio,s.height/window.devicePixelRatio);return await new Promise(t=>e.toBlob(e=>t(e)),"image/png")}async draw(e,t,a){null!==this.offsetParent?(this._staged_view=void 0,this._settings&&(this._settings.axisMemo=[[1/0,-1/0],[1/0,-1/0]]),await this.update(e,t,a,!0)):this._staged_view=[e,t,a]}async update(e,t,a,n=!1){if(null===this.offsetParent)return;let l,r,i=this.parentElement,o="Sunburst"!==this._chart.plugin.name;l=t&&a?e.to_columns_string({end_row:a,end_col:t,leaves_only:o}):t?e.to_columns_string({end_col:t,leaves_only:o}):a?e.to_columns_string({end_row:a,leaves_only:o}):e.to_columns_string({leaves_only:o}),r=await Promise.all([i.save(),i.getTable().then(e=>e.schema()),e.expression_schema(!1),e.schema(!1),l,e.get_config()]);let[s,c,h,u,d,g]=r,p=JSON.parse(d),m=Object.keys(p),y={row(e){let t={};for(let a of m)t[a]=p[a][e];return t}};this.config=s;let f=this.config.columns,x=function(e){let t=c[e];return t||(t=h[e]),t},{columns:v,group_by:b,split_by:w,filter:V}=g,_=p[Object.keys(p)[0]]||[],k=b.length>0?_.reduce((e,t,a)=>{let n=y.row(a);if(n.__ROW_PATH__&&n.__ROW_PATH__.length==b.length)e.agg_paths.push(e.aggs.slice()),e.rows.push(n);else{let t=n.__ROW_PATH__.filter(e=>void 0!==e).length;e.aggs[t]=n,e.aggs=e.aggs.slice(0,t+1)}return e},{rows:[],aggs:[],agg_paths:[]}):{rows:_.map((e,t)=>y.row(t))},S=k.rows.map((e,t)=>b.length?e:{...e,__ROW_PATH__:[t]}),z={realValues:f,crossValues:b.map(e=>({name:e,type:x(e)})),mainValues:v.map(e=>({name:e,type:u[e]})),splitValues:w.map(e=>({name:e,type:x(e)})),filter:V,data:S,agg_paths:k.agg_paths,...this.config.plugin_config},A={set:(e,t,a)=>(Pt.includes(t)||this._container&&this._container.dispatchEvent(new Event("perspective-plugin-update",{bubbles:!0,composed:!0})),e[t]=a,!0)};this._settings=new Proxy({axisMemo:[[1/0,-1/0],[1/0,-1/0]],...this._settings,...z},A),this._settings.splitMainValues&&this._settings.splitMainValues.length>=v.length&&(this._settings.splitMainValues=[]),zt(this._container,this._settings),n&&(this._container.innerHTML=""),this._draw(),await new Promise(e=>requestAnimationFrame(e))}async clear(){this._container&&(this._container.innerHTML="")}_draw(){if(null!==this.offsetParent){let e=r.Ltv(this._container),t=`chart ${this._chart.plugin.name.toLowerCase().replace(/[ \t\r\n\/]*/g,"")}`;this._settings.size=this._container.getBoundingClientRect(),this._settings.data.length>0?this._chart(e.attr("class",t),this._settings):e.attr("class",`${t} disabled`)}}async resize(e){if(null!==this.offsetParent)if(void 0!==this._settings?.data)this._draw();else{let[e,t,a]=this._staged_view;this._staged_view=void 0,this.draw(e,t,a)}}async restyle(e,t,a){let n=this._settings;n&&(delete n.colorStyles,delete n.textStyles,this.isConnected&&(zt(this._container,this._settings),this.resize(e)))}async delete(){this._container.innerHTML=""}getContainer(){return this._container}save(){let e={...this._settings};return Pt.forEach(t=>{delete e[t]}),e}restore(e,t){let a={};for(let n of Pt)void 0!==this._settings?.[n]&&(a[n]=this._settings?.[n]);this._settings={...a,...e,columns_config:t}}};await En(),n()}catch(Et){n(Et)}},1)}}]);